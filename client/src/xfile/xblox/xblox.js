//>>built
require({cache:{"xblox/delegate/BlockActionMixin":function(){define(["dojo/_base/array","dojo/_base/declare","xide/factory","xblox/widgets/AddBlockWidget"],function(array,declare,factory,AddBlockWidget){return declare("xblox.delegate.BlockActionMixin",null,{currentItem:null,prevItem:null,nextItem:null,_watchers:null,blockScope:null,blockToolbar:null,blockProvider:null,blockStore:null,blockGroup:null,blockGridView:null,newRootItemGroup:null,save:true,paste:function(items,owner,cut){var target=this.getItem(),
_flatten,source,thiz=this;if(!owner||!owner.gridView)return;if(!target){for(var i=0;i<items.length;i++){var obj=items[i];if(obj.parentId){obj._parentOri=""+obj.parentId;obj.parentId=null}}_flatten=this.blockScope.flatten(items);var _clones=this.blockScope.cloneBlocks2(_flatten,this.newRootItemGroup);var firstItem=null;for(var i=0;i<_clones.length;i++){var clone=_clones[i];if(!firstItem)firstItem=clone}for(var i=0;i<items.length;i++){var obj=items[i];if(obj._parentOri){obj.parentId=obj._parentOri;
delete obj["_parentOri"]}}this.gridView.refresh();this.onItemAdded(firstItem,firstItem);this.currentItem=firstItem;setTimeout(function(){if(thiz.blockGridView.select)thiz.blockGridView.select(firstItem,true)},50);return}var grid=owner.gridView.grid;var srcScope=items[0].scope;var dstScope=target.scope;if(srcScope!=dstScope)return;if(!cut)return;var insert=target.canAdd()||false;var parent=srcScope.getBlockById(target.parentId);if(!parent)parent=target;var targetState="Moved";var before=false;_flatten=
this.blockScope.flatten(items);items=srcScope.cloneBlocks(_flatten);for(var i=0;i<items.length;i++){source=items[i];if(source==target)0&&console.log("source\x3dtarget!");source.parentId=parent.id;if(parent)parent.add(source);this.onDrop(source,target,before,grid,targetState,insert)}},onDrop:function(source,target,before,grid,targetState,insert){var ctrArgs=source.ctrArgs||{};var proto=source.proto;var add=!before==true&&target.parentId==null;var newBlock=null;var isNewItem=false;if(source.ctrArgs){ctrArgs.scope=
ctrArgs.scope||target.scope;ctrArgs.group=ctrArgs.group||target.group;ctrArgs.parentId=ctrArgs.parentId||target.id;isNewItem=true}if(isNewItem)if(target.parentId==null&&!insert){ctrArgs.parentId=null;newBlock=factory.createBlock(proto,ctrArgs)}else{if(insert&&target.canAdd&&target.canAdd()!=null)newBlock=target.add(proto,ctrArgs,null)}else if(targetState==="Moved")if(source.scope&&target.scope&&source.scope==target.scope){var moved=target.scope.moveTo(source,target,before,insert);if(moved)this.saveItems();
else console.error("weird, didnt move");var store=this.blockScope[this.storeField]||this.blockStore||this.blockScope.blockStore;this.gridView.grid.set("store",store,{group:this.blockGroup});return}else console.error("weird");if(newBlock&&newBlock.postCreate)newBlock.postCreate();var store=this.blockScope[this.storeField]||this.blockStore||this.blockScope.blockStore;this.gridView.grid.set("store",store,{group:this.blockGroup});if(newBlock)this.onItemAdded(target,newBlock)},execute:function(block){if(!block||
!block.scope){console.error("have no scope");return}try{var result=block.scope.solveBlock(block,{highlight:true,force:true})}catch(e){console.error(" excecuting block -  "+block.name+" failed! : "+e);console.error(printStackTrace().join("\n\n"))}},editBlock:function(item){if(!item)return;var thiz=this;var _edited=function(item){if(thiz.save&&thiz.delegate&&thiz.delegate.save)thiz.delegate.save(thiz);thiz.onItemAction(item,false)};var blockManager=this.delegate.getBlockManager?this.delegate.getBlockManager():
this.ctx.getBlockManager();blockManager.editBlock(item,_edited)},removeItem:function(item,updateWatchers){item=item||this.currentItem;0&&console.log("removing block : "+item.name+" | "+item.id);try{if(!item)return false;if(item.remove)item.remove();var store=this.blockScope[this.storeField]||this.blockStore||this.blockScope.blockStore;if(store)store.remove(item.id);if(updateWatchers!==false)this.onItemAction(item);return true}catch(e){debugger}},onItemAdded:function(parent,newItem){if(!parent||!newItem)return false;
if(this.blockGridView)try{if(this.blockGridView.expand)this.blockGridView.expand(parent,true);if(this.blockGridView.select)this.blockGridView.select(newItem,true)}catch(e){console.error("error expanding new blocks!",e)}this.saveItems()},addItem:function(menuItem){var item=menuItem.item;if(!item)return;var target=item.target,thiz=this;var proto=item.proto;var ctorArgs=item.ctrArgs;var where=null;var newBlock=null;if(!target){var _item=this.getItem();if(_item)target=_item}if(target&&proto&&ctorArgs){if(target.owner&&
target.dstField){where=target.dstField;target=target.owner}ctorArgs["parentId"]=target.id;ctorArgs["group"]=null;ctorArgs["parent"]=target;newBlock=target.add(proto,ctorArgs,where);newBlock.parent=target}else if(!target&&proto&&ctorArgs){if(ctorArgs.group==="No Group"&&this.newRootItemGroup)ctorArgs.group=this.newRootItemGroup;if(!ctorArgs.group&&this.newRootItemGroup)ctorArgs.group=this.newRootItemGroup;newBlock=factory.createBlock(proto,ctorArgs)}if(newBlock&&newBlock.postCreate)newBlock.postCreate();
var store=this.blockScope[this.storeField]||this.blockStore||this.blockScope.blockStore;thiz.gridView.grid.refresh();thiz.onItemAdded(target,newBlock)},onItemSelected:function(item){try{}catch(e){console.error("publish ON_BLOCK_SELECTED failed "+e)}this.currentItem=item;if(!this.hasItemActions(item))return;var actions=this.getItemActions(item);if(this.blockToolbar){this.blockToolbar.clear();this.blockToolbar.addActions(actions,this,null)}},hasItemActions:function(item){return true},getItem:function(){return this.currentItem},
move:function(dir){var item=this.getItem();if(!item||!item.parentId)return;try{item.move(item,dir);this.onItemAction(true);0&&console.log("move up to"+item.name)}catch(e){debugger}},saveItems:function(){if(this.save&&this.delegate&&this.delegate.save)this.delegate.save()},getItemActions:function(item){item=item||this.currentItem;var thiz=this;var actions=[];var _createAction=this.createAddBlockWidget(item);actions.push(_createAction);if(item){if(item.canDelete!==false)actions.push(this._createAction("Remove",
"el-icon-remove-sign",item,function(){thiz.removeItem()}));if(item.canMove(null,-1))actions.push(this._createAction("Up","el-icon-circle-arrow-up",item,function(){thiz.move(-1)}));if(item.canMove(null,1))actions.push(this._createAction("Down","el-icon-circle-arrow-down",item,function(){thiz.move(1)}));actions.push({title:"Play",icon:"el-icon-play",place:"last",emit:false,style:"",handler:function(){thiz.execute(item)}});actions.push({title:"Reload",icon:"el-icon-refresh",place:"last",emit:false,style:"",
handler:function(){thiz.reload()}})}return actions},update:function(){try{array.forEach(this._watchers,function(item){item()})}catch(e){debugger}},onItemAction:function(save){try{array.forEach(this._watchers,function(item){item()})}catch(e){debugger}if(save!==false)this.saveItems()},registerUpdateFunction:function(fn){if(!this._watchers)this._watchers=[];this._watchers.push(fn)},createAddBlockWidget:function(item){var _addBlock=new AddBlockWidget({item:item,delegate:this,style:"float:left;"},dojo.doc.createElement("div"));
_addBlock.startup();return _addBlock},_createAction:function(label,icon,item,clickFunction){return{title:label,icon:item?item.icon||icon:null,place:"last",emit:false,style:"",handler:clickFunction}}})})},"xblox/views/BlockEditDialog":function(){define(["dojo/_base/declare","xide/views/CIActionDialog","xide/factory","xide/types","xide/utils","xblox/views/BlockEditView"],function(declare,CIActionDialog,factory,types,utils,BlockEditView){return declare("xblock.views.BlockEditDialog",[CIActionDialog],
{onSave:function(ci,value){if(ci.dst&&this.item[ci.dst])this.item[ci.dst]=value},initWithCIS:function(cis){this.cisView=utils.addWidget(BlockEditView,{delegate:this,options:{groupOrder:{"General":0,"Advanced":1,"Description":2}},cis:cis},this,this.containerNode,true)},onOk:function(){var cis=this.cisView.getCIS();var options=utils.toOptions(cis);for(var i=0;i<options.length;i++){var option=options[i];var field=option.dst;if(field!=null&&this.item[field]!=null){if(option.active!=null&&option.active===
false&&option.changed===false)continue;if(this.item[option.dst]!=option.value||this.item[option.dst]!==option.value){if(this.item.onChangeField)this.item.onChangeField(option.dst,option.value);this.item[option.dst]=option.value}}}if(this.delegate&&this.delegate.onOk)this.delegate.onOk(this,this.item);try{this.hide()}catch(e){}return true},initWithBlock:function(item){var cis=item.getFields();if(cis)this.initWithCIS(cis)},startup:function(){this.inherited(arguments);if(this.item)this.initWithBlock(this.item);
this.addActionButtons();this.inherited(arguments)}})})},"xblox/model/Block":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","./ModelBase","xide/factory","xide/utils"],function(declare,Deferred,lang,ModelBase,factory,utils){return declare("xblox.model.Block",[ModelBase],{serializeMe:true,name:null,description:"No Description",enabled:true,shareTitle:"",sharable:false,items:null,parent:null,canDelete:true,renderBlockIcon:true,_return:null,_lastResult:null,_deferredObject:null,
_currentIndex:0,_lastRunSettings:null,_onLoaded:false,beanType:"BLOCK",override:{},ignoreSerialize:["_currentIndex","_deferredObject","_return","parent","ignoreSerialize","_lastRunSettings","_onLoaded","beanType","sharable","override"],canAdd:function(){return null},addToEnd:function(array1,array2){if(array2&&array1.length!=null&&array2.length!=null)array1.push.apply(array1,array2);else console.error("add to end failed : invalid args in"+this.name);return array1},removeBlock:function(what,del){if(what){if(del!==
false&&what.empty)what.empty();if(del!==false)delete what.items;what.parent=null;if(this.items)this.items.remove(what)}},_getContainer:function(item){return"items"},empty:function(what){try{this._empty(what)}catch(e){debugger}},_empty:function(what){var data=what||this.items;if(data)for(var i=0;i<data.length;i++){var subBlock=data[i];if(subBlock&&subBlock.empty)subBlock.empty();if(subBlock&&this.scope&&this.scope.blockStore)this.scope.blockStore.remove(subBlock.id)}},containsItem:function(data,obj){var i=
data.length;while(i--)if(data[i].id===obj.id)return true;return false},indexOf:function(data,obj){var i=data.length;while(i--)if(data[i].id===obj.id)return i;return-1},_getBlock:function(dir){try{var item=this;if(!item||!item.parentId)return false;var parent=this.scope.getBlockById(item.parentId);if(!parent)return null;var items=parent[parent._getContainer(item)];if(!items||items.length<2||!this.containsItem(items,item))return null;var cIndex=this.indexOf(items,item);if(cIndex+dir<0)return false;
var upperItem=items[cIndex+dir];if(upperItem)return upperItem}catch(e){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},getPreviousResult:function(){var parent=this.getPreviousBlock()||this.getParent();if(parent&&parent._lastResult!=null)if(this.isArray(parent._lastResult))return parent._lastResult;else return[parent._lastResult];return null},_getArg:function(val){var _float=parseFloat(val);if(!isNaN(_float))return _float;
else{if(val==="true"||val==="false")return utils.toBoolean(val);return val}return val},getArgs:function(){var result=[],_inArgs=this._get("args");if(_inArgs){result=utils.getJson(_inArgs);if(result!=null&&this.isArray(result));}if(result.length==0&&_inArgs&&_inArgs.length&&this.isString(_inArgs))if(_inArgs.indexOf(",")!==-1){var _splitted=_inArgs.split(",");for(var i=0;i<_splitted.length;i++){var _float=parseFloat(_splitted[i]);if(!isNaN(_float))result.push(_float);else if(_splitted[i]==="true"||
_splitted[i]==="false")result.push(utils.toBoolean(_splitted[i]));else result.push(_splitted[i])}return result}else result=[this._getArg(_inArgs)];var previousResult=this.getPreviousResult();if(previousResult!=null)if(lang.isArray(previousResult)&&previousResult.length==1)result.push(previousResult[0]);else result.push(previousResult);return result},canMove:function(item,dir){try{item=item||this;if(!item||!item.parentId)return false;var parent=this.scope.getBlockById(item.parentId);if(!parent)return false;
var items=parent[parent._getContainer(item)];if(!items||items.length<2||!this.containsItem(items,item))return false;var cIndex=this.indexOf(items,item);if(cIndex+dir<0)return false;var upperItem=items[cIndex+dir];if(!upperItem)return false}catch(e){debugger}return true},move:function(item,dir){item=item||this;if(!item||!item.parentId)return false;var parent=this.scope.getBlockById(item.parentId);if(!parent)return false;var items=parent[parent._getContainer(item)];if(!items||items.length<2||!this.containsItem(items,
item))return false;var cIndex=this.indexOf(items,item);if(cIndex+dir<0)return false;var upperItem=items[cIndex+dir];if(!upperItem)return false;items[cIndex+dir]=item;items[cIndex]=upperItem;return true},remove:function(what){if(this.parentId!=null&&this.parent==null)this.parent=this.scope.getBlockById(this.parentId);if(this.parent&&this.parent.removeBlock){this.parent.removeBlock(this);return}what=what||this;if(what){if(what.empty)what.empty();delete what.items;what.parent=null;if(this.items)this.items.remove(what)}},
prepareBlockContructorArgs:function(ctorArgs){if(!ctorArgs)ctorArgs={};if(!ctorArgs["id"])ctorArgs["id"]=this.createUUID();if(!ctorArgs["items"])ctorArgs["items"]=[];if(!ctorArgs["scope"]);},_add:function(proto,ctrArgs,where){var _block=null;try{if(ctrArgs){this.prepareBlockContructorArgs(ctrArgs);_block=factory.createBlock(proto,ctrArgs)}else if(ctrArgs==null)_block=proto;_block.scope=this.scope;if(this.scope)this.scope.registerBlock(_block);_block.parent=this;_block.parentId=this.id;if(where==null){if(!this.items)this.items=
[];this.items.push(_block)}else if(this[where]&&this[where].push)this[where].push(_block);return _block}catch(e){debugger}return null},add:function(proto,ctrArgs,where){return this._add(proto,ctrArgs,where)},getContext:function(){if(this.scope.context&&this.scope.context.instance)return this.scope.context.instance;return null},resolved:function(){if(this._deferredObject){this._deferredObject.resolve();delete this._deferredObject}},_solve:function(scope,settings){settings=settings||{highlight:false};
var ret=[];for(var n=0;n<this.items.length;n++){var block=this.items[n];this.addToEnd(ret,block.solve(scope,settings))}return ret},solve:function(scope,settings){settings=settings||{highlight:false};var ret=[];for(var n=0;n<this.items.length;n++){var block=this.items[n];this.addToEnd(ret,block.solve(scope,settings))}return ret},solveMany:function(scope,settings){if(!this._lastRunSettings&&settings)this._lastRunSettings=settings;settings=this._lastRunSettings||settings;this._currentIndex=0;this._return=
[];var ret=[],items=this[this._getContainer()];if(items.length){var res=this.runFrom(items,0,settings);this.onSuccess(this,settings);return res}else this.onSuccess(this,settings);return ret},runFrom:function(blocks,index,settings){var thiz=this,blocks=blocks||this.items;var onFinishBlock=function(block,results){block._lastResult=block._lastResult||results;thiz._currentIndex++;thiz.runFrom(blocks,thiz._currentIndex,settings)};var wireBlock=function(block){block._deferredObject.then(function(results){onFinishBlock(block,
results)})};if(blocks.length)for(var n=index;n<blocks.length;n++){var block=blocks[n];if(block.deferred===true){block._deferredObject=new Deferred;this._currentIndex=n;wireBlock(block);this.addToEnd(this._return,block.solve(this.scope,settings));break}else this.addToEnd(this._return,block.solve(this.scope,settings))}else this.onSuccess(this,settings);return this._return},onActivity:function(block,settings,event){this.publish(event,null,block)},onRun:function(block,settings){var highlight=settings&&
settings.highlight;if(block&&highlight)this.onActivity(block,settings,this.types.EVENTS.ON_RUN_BLOCK)},onFailed:function(block,settings){var highlight=settings&&settings.highlight;if(block&&highlight)this.onActivity(block,settings,this.types.EVENTS.ON_RUN_BLOCK_FAILED)},onSuccess:function(block,settings){var highlight=settings&&settings.highlight;if(block&&highlight)this.onActivity(block,settings,this.types.EVENTS.ON_RUN_BLOCK_SUCCESS)},canDisable:function(){return true},getParent:function(){if(this.parentId)return this.scope.getBlockById(this.parentId);
return null},getDefaultFields:function(){var fields=[];if(this.canDisable&&this.canDisable()!==false)fields.push(this.utils.createCI("enabled",0,this.enabled,{group:"General",title:"Enabled",dst:"enabled"}));fields.push(this.utils.createCI("condition",26,this.description,{group:"Description",title:"Description",dst:"description",useACE:false}));if(this.sharable)fields.push(this.utils.createCI("enabled",13,this.shareTitle,{group:"Share",title:"Title",dst:"shareTitle",toolTip:"Enter an unique name to share this block!"}));
return fields},getFields:function(){return this.getDefaultFields()},toFriendlyName:function(str){var special=["[","]","(",")","{","}"];for(var n=0;n<special.length;n++)str=str.replace(special[n],"");str=utils.replaceAll("\x3d\x3d"," equals ",str);str=utils.replaceAll("'","",str);return str},getIconClass:function(){return null},getBlockIcon:function(symbol){symbol=symbol||"";return this.renderBlockIcon==true?'\x3cspan class\x3d"xBloxIcon"\x3e'+symbol+"\x3c/span\x3e":""},serializeField:function(name){return this.ignoreSerialize.indexOf(name)==
-1},onLoad:function(){},activate:function(){},deactivate:function(){},onFieldsRendered:function(block,cis){},onChangeField:function(field,newValue){if(field=="enabled")if(newValue==true)this.activate();else this.deactivate()},_get:function(what){return what in this.override?this.override[what]:this[what]},onDidRun:function(){this.override={}}})})},"xblox/model/Contains":function(){define(["dojo/_base/declare"],function(declare){return declare("xblox.model.Contains",null,{mayHaveChildren:function(parent){var items=
this[this._getContainer()];return items!=null&&items.length>0},getChildren:function(parent){return this[this._getContainer()]},canAdd:function(){return[]},solve:function(scope,settings,run,error){if(!this._lastRunSettings&&settings)this._lastRunSettings=settings;settings=this._lastRunSettings||settings;this._currentIndex=0;this._return=[];var ret=[],items=this[this._getContainer()];if(items.length){var res=this.runFrom(items,0,settings);this.onSuccess(this,settings);return res}else this.onSuccess(this,
settings);return ret}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define(["dojo/_base/declare","xblox/model/Block","xide/utils","xide/types","xide/factory"],function(declare,Block,utils,types,factory){return declare("xblox.model.variables.VariableAssignmentBlock",[Block],{variable:null,value:null,name:"Set Variable",toText:function(){var res=this.getBlockIcon("C")+this.name+" "+this.variable+" to "+this.value;return res},solve:function(scope,settings){if(this.variable&&this.value){this.onRun(this,
settings);var _variable=scope.getVariable(this.variable);if(!_variable){console.error("     no such variable : "+this.variable);return[]}if(this.isScript(this.value)){_variable.value=scope.parseExpression(this.value);_variable.value=this.replaceAll("'","",_variable.value)}else _variable.value=this.value;0&&console.log(this.variable+" is now "+_variable.value);factory.publish(types.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:_variable,scope:this.scope,save:false,block:this});return[]}},canAdd:function(){return null},
getFields:function(){var fields=this.inherited(arguments);var thiz=this;fields.push(this.utils.createCI("Variable",3,this.variable,{group:"General",options:this.scope.getVariablesAsOptions(),dst:"variable"}));fields.push(this.utils.createCI("value",25,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(val,run,error){return thiz.scope.expressionModel.parse(thiz.scope,val,false,run,error)}}}));return fields}})})},"xblox/model/logging/Log":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/Deferred","xblox/model/Block","xide/utils","xide/types","xide/mixins/EventedMixin"],function(declare,lang,array,Deferred,Block,utils,types,EventedMixin){return declare("xblox.model.logging.Log",[Block,EventedMixin],{name:"Log Message",level:"info",message:"",type:"XBlox",host:"this host",sharable:true,toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.message)result+=this.message;return result},_solveExpression:function(expression,
scope,settings,run,error){var _script=""+expression;var thiz=this;if(_script&&_script.length){var _function=new Function("{"+_script+"}");var _args=this.getArgs();try{var _parsed=_function.apply(this,_args||{});if(run)run("Expression "+_script+" evaluates to "+_parsed);return _parsed}catch(e){if(error)error("invalid expression : \n"+_script+": "+e);return _script}}else console.error("have no script");return _script},solve:function(scope,settings,run,error){var _message=this._solveExpression(this.message,
scope,settings,run,error);var message={message:_message,level:this.level,type:this.type,details:this.getArgs()};this.onSuccess(this,settings);try{this.publish(types.EVENTS.ON_SERVER_LOG_MESSAGE,message)}catch(e){this.onFailed(this,settings)}return[]},canAdd:function(){return null},getFields:function(){var fields=this.inherited(arguments)||this.getDefaultFields();var thiz=this;var options=[{value:"info",label:"Info"},{value:"warning",label:"Warning"},{value:"error",label:"Error"}];fields.push(this.utils.createCI("Event",
3,this.event,{group:"General",options:options,dst:"level"}));fields.push(this.utils.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(val,run,error){var _res=thiz._solveExpression(val,thiz.scope,null,run,error)}}}));fields.push(this.utils.createCI("message",13,this.type,{group:"General",title:"Type",dst:"type"}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/logic/CaseBlock":function(){define(["dojo/_base/declare",
"xblox/model/Block"],function(declare,Block){return declare("xblox.model.logic.CaseBlock",[Block],{comparator:null,expression:null,items:null,name:"Case",toText:function(){var _comparator=""+this.comparator;if(_comparator=="\x3d\x3d")_comparator="";return this.getBlockIcon("I")+this.name+" "+_comparator+(this.expression!=null?" "+this.expression:"")},canAdd:function(){return[]},solve:function(scope,switchBlock,settings){var switchVarValue=scope.getVariable(switchBlock.variable).value;var compResult=
scope.parseExpression("'"+switchVarValue+"'"+this.comparator+this.expression);if(compResult===true){this.onSuccess(this,settings);return this._solve(scope,settings)}else{this.onFailed(this,settings);return false}},getChildren:function(parent){return this.items},getFields:function(){var fields=this.inherited(arguments);fields=fields.concat(this.inherited(arguments));fields.push(this.utils.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));fields.push(this.utils.createCI("Comparator",
13,this.comparator,{group:"General",title:"Comparator",dst:"comparator"}));return fields}})})},"xblox/model/html/SetStyle":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","xblox/model/Block","xide/types","xide/mixins/EventedMixin","xblox/model/Targeted","dijit/registry","dojo/dom-attr","dojo/dom-style","dojo/_base/Color"],function(declare,ArrayUtil,lang,Block,types,EventedMixin,Targeted,registry,domAttr,domStyle,Color){return declare("xblox.model.html.SetStyle",[Block,
EventedMixin,Targeted],{name:"Set Style",reference:"",references:null,description:"Sets HTML Node Style Attribute",value:"",mode:1,sharable:true,solve:function(scope,settings){this.updateObjects(null,this.value,this.mode);this.onSuccess(this,settings)},toText:function(){var _ref=this.deserialize(this.reference);var result=this.getBlockIcon()+" "+this.name+" :: on "+_ref.reference+" to"||" "+" to ";if(this.value)result+=" "+this.value;return result},getFields:function(){var fields=this.inherited(arguments)||
this.getDefaultFields();var thiz=this;fields.push(this.utils.createCI("Value",types.ECIType.DOM_PROPERTIES,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:false}));fields.push(this.utils.createCI("Mode",types.ECIType.ENUMERATION,this.mode,{group:"General",options:[this.utils.createOption("Set",1),this.utils.createOption("Add",2),this.utils.createOption("Remove",3),this.utils.createOption("Increase",4),this.utils.createOption("Decrease",5)],dst:"mode"}));fields.push(this.utils.createCI("Target",
types.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},destroy:function(){this.inherited(arguments)},updateEventSelector:function(objects,cis){var options=[];if(!objects||!objects.length)options=this.scope.getEventsAsOptions(this.event);else{options=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},
{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}];for(var i=0;i<options.length;i++){var obj=options[i];if(obj.value===this.event){obj.selected=true;break}}}for(var i=0;i<cis.length;i++){var ci=
cis[i];if(ci["widget"]&&ci["widget"].title==="Event"){var widget=ci["_widget"];widget.nativeWidget.set("options",options);widget.nativeWidget.reset();widget.nativeWidget.set("value",this.event);this.publish(types.EVENTS.RESIZE,{});break}}},onReferenceChanged:function(newValue,cis){this.reference=newValue;this.references=this.resolveReference(this.deserialize(newValue));this.updateObjects(this.references,this.value)},getPropValue:function(stylesObject,prop){for(var _prop in stylesObject)if(_prop===
prop)return stylesObject[_prop];return null},_getStyle:function(name,obj,jObj){switch(name){case "height":return jObj.outerHeight();case "width":return jObj.outerWidth();case "color":return jObj.css("color");case "border-color":return jObj.css("border-color")||"rgba(0,0,0,0)"}return null},updateObject:function(obj,style,mode){if(!obj)return false;mode=mode||1;if(obj.domNode!=null)obj=obj.domNode;var currentStyle=domAttr.get(obj,"style");var styleAttribute=""+currentStyle;if(currentStyle===";")currentStyle=
"";if(currentStyle==="")if(obj["lastStyle"]!=null)currentStyle=obj["lastStyle"];else currentStyle=style;if(currentStyle===";")currentStyle=style;switch(mode){case 1:domAttr.set(obj,"style",style);break;case 2:domAttr.set(obj,"style",currentStyle+";"+style);break;case 3:domAttr.set(obj,"style",this.utils.replaceAll(style,"",currentStyle));break;case 4:case 5:var numbersOnlyRegExp=new RegExp(/(\D*)(-?)(\d+)(\D*)/);var stylesRequested=this._toObject(style);var stylesComputed={};var jInstance=$(obj);
if(stylesRequested)for(var prop in stylesRequested){var currentStyle=this._getStyle(prop,obj,jInstance);stylesComputed[prop]=currentStyle}var _newStyleObject={};for(var prop in stylesRequested){var _prop=""+prop.trim();var multiplicator=1;if(stylesComputed[_prop]!=null){var _valueRequested=stylesRequested[prop];var _valueComputed=stylesComputed[prop];var _isHex=_valueRequested.indexOf("#")!=-1;var _isRGB=_valueRequested.indexOf("rgb")!=-1;var _isRGBA=_valueRequested.indexOf("rgba")!=-1;if(_isHex||
_isRGB||_isRGBA){var dColorMultiplicator=dojo.colorFromString(_valueRequested);var dColorNow=dojo.colorFromString(_valueRequested);var dColorComputed=dojo.colorFromString(_valueComputed);var dColorNew=new Color;ArrayUtil.forEach(["r","g","b","a"],function(x){dColorNew[x]=Math.min(dColorComputed[x]+dColorMultiplicator[x],x=="a"?1:255)});0&&console.log("color computed "+dColorComputed.toRgba()+" color requested: "+dColorNow.toRgba()+" | multiplicator color \x3d "+dColorMultiplicator.toRgba()+" is then \x3d "+
dColorNew.toRgba());var _valueOut="";if(_isHex)_valueOut=dColorNew.toHex();else if(_isRGB)_valueOut=dColorNew.toCss(false);else if(_isRGBA)_valueOut=dColorNew.toCss(true);_newStyleObject[prop]=_valueOut;domStyle.set(obj,prop,_valueOut)}else{var numberOnly=numbersOnlyRegExp.exec(stylesComputed[_prop]);if(numberOnly&&numberOnly.length>=3){var _int=parseInt(numberOnly[3]);if(_int&&_int>0)multiplicator=_int}}}}var delta=mode==4?1:-1;var styles=this._toObject(currentStyle);var inStyles=this._toObject(style);
if(!styles)return false;var _skipped=[];for(var prop in styles)var _prop=""+prop.trim();var newStyleString=this._toStyleString(_newStyleObject);break}},onDomStyleChanged:function(objects,newStyle,mode){if(mode==4||mode==5);objects=objects||this.resolveReference(this.deserialize(this.reference));if(!objects){0&&console.log("have no objects");return}0&&console.log("change dom style to "+newStyle+" on "+objects.length+" objects");for(var i=0;i<objects.length;i++){var obj=objects[i];if(obj&&obj.id&&obj.id.indexOf("davinci")!=
-1)continue;this.updateObject(obj,newStyle,mode);if(i>1);}},updateObjects:function(objects,domStyleString,mode){objects=objects||this.resolveReference(this.deserialize(this.reference));this.onDomStyleChanged(objects,domStyleString,mode)},onChangeField:function(field,newValue,cis){this._destroy();if(field=="mode"&&newValue!==this.mode)this.mode=newValue;if(field=="value"&&newValue!==this.value){this.onDomStyleChanged(null,newValue,this.mode);this.value=newValue}if(field=="reference")this.onReferenceChanged(newValue,
cis);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){},_changeValue:function(value,delta){if(!value)return"";var split=value.split(" ");var result="";for(var i=0;i<split.length;i++){if(i>0)result+=" ";var bits=split[i].match(/([-\d\.]+)([a-zA-Z%]*)/);if(!bits)result+=split[i];else if(bits.length==1)result+=bits[0];else for(var z=1;z<bits.length;z++)if(!isNaN(bits[z])&&bits[z]!="")result+=parseFloat(bits[z])+delta;else result+=
bits[z]}return result},_toObject:function(styleString){if(!styleString)return{};var _result={};var _values=styleString.split(";");for(var i=0;i<_values.length;i++){var obj=_values[i];if(!obj||obj.length==0||!obj.split)continue;var keyVal=obj.split(":");if(!keyVal||!keyVal.length)continue;_result[keyVal[0]]=keyVal[1]}return _result},_toStyleString:function(values){var _values=[];for(var prop in values)_values.push(prop+":"+values[prop]);return _values.join(";")+";"}})})},"xblox/model/server/RunServerMethod":function(){define(["dojo/_base/declare",
"xblox/model/server/ServerBlock","xide/utils"],function(declare,ServerBlock,utils){return declare("xblox.model.server.RunServerMethod",[ServerBlock],{description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:true,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:true,onMethodChanged:function(newMethod,cis){this.method=newMethod;if(!utils.isValidString(this.args)){var newServerParams=this.getServerParams();if(newServerParams)this._updateArgs(newServerParams,
cis)}},_getArgs:function(){var _args=utils.getJson(this.args);var result=[];if(_args){var isSMD=false;if(_args&&_args[0]["optional"]!=null)isSMD=true;if(isSMD)for(var i=0;i<_args.length;i++){var _arg=_args[i];var _variableValue=_arg.value;var isBase64=_arg.name.indexOf("Base64")!=-1;if(isBase64)_variableValue=this.getService().base64_encode(_variableValue);if(_arg.value!=="notset")if(_arg.value.indexOf("[")!=-1&&_arg.value.indexOf("]")!=-1){_variableValue=this.scope.expressionModel.replaceVariables(this.scope,
_arg.value,false,false);if(_arg.name.indexOf("Base64")!=-1)_variableValue=this.getService().base64_encode(_variableValue);result.push(_variableValue)}else result.push(_variableValue||_arg["default"]);else result.push(_arg["default"]||_variableValue)}else;}else;return result},_updateArgs:function(params,cis){var argumentWidget=this.utils.getCIWidgetByName(cis,"args");if(argumentWidget){var _string=JSON.stringify(params);argumentWidget.editBox.set("value",_string);this.args=_string}},getServerParams:function(){var service=
this.getService();var params=service.getParameterMap(this.getServiceClass(),this.getServiceMethod());if(params)for(var i=0;i<params.length;i++){var param=params[i];param.value="notset"}return params},solve:function(scope,settings,run,error){this._return=[];this._lastResult=null;var thiz=this;var ret=[];if(!this.isInValidState()){this.onFailed(this,settings);return ret}var _args=this._getArgs();var _cbSuccess=function(response){thiz._lastResult=thiz.utils.getJson(response)||[response];thiz.resolved(thiz._lastResult);
thiz.onSuccess(thiz,settings)};var _cbError=function(response){thiz._lastResult=thiz.utils.getJson(response)||[response];thiz.resolved(thiz._lastResult);thiz.onFailed(thiz,settings)};this.onRun(this,settings);this.getService().callMethodEx(this.getServiceClass(),this.getServiceMethod(),_args,_cbSuccess,_cbError);return ret},toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.method)result+=this.method.substr(0,50);return result},canAdd:function(){return[]},getFields:function(){var fields=
this.getDefaultFields();var thiz=this;fields.push(this.utils.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(val,run,error){var old=thiz.method;thiz.method=val;var _res=thiz.solve(thiz.scope,null,run,error)}}}));fields=fields.concat(this.getServerDefaultFields());return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(parent){return this.items!=
null&&this.items.length>0},getChildren:function(parent){return this.items},onChangeField:function(field,newValue,cis){if(field==="method")this.onMethodChanged(newValue,cis)},isInValidState:function(){return this.getService()!=null},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(method){return this.isInValidState()&&
this.getService()[this.getServiceClass()]!=null&&this.getService()[this.getServiceClass()][this.getServiceMethod()]!=null},hasServerClass:function(_class){return this.isInValidState()&&this.getService()[this.getServiceClass()]!=null},getServerFunction:function(){if(this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod())return this.getService()[this.getServiceClass()][this.getServiceMethod()];return null}})})},"xblox/views/GroupedBlockView":function(){define(["dojo/_base/declare","dojo/_base/lang",
"xide/utils","xide/factory","xide/types","xide/mixins/EventedMixin","xide/views/ActionTogglePane","xide/widgets/ActionToolbar","dojo/store/Memory","dojo/store/Observable","xblox/model/variables/VariableAssignmentBlock","xblox/delegate/BlockActionMixin","dojo/Stateful"],function(declare,lang,utils,factory,types,EventedMixin,ActionTogglePane,ActionToolbar,Memory,Observable,VariableAssignmentBlock,BlockActionMixin,Stateful){return declare("xblox.views.GroupedBlockView",[Stateful,EventedMixin,BlockActionMixin],
{cssClass:"commandSettings",settingsPane:null,view:null,currentItem:null,gridView:null,attachTo:null,title:null,gridViewProto:null,newRootItemFunction:null,newRootItemLabel:"New Command",newRootItemIcon:"el-icon-video",createTestBlocks:false,showAllBlocks:false,open:true,storeField:"blockStore",handleContainerClick:true,clearSelection:true,keyboardNavigation:true,mouseNavigation:true,gridParams:null,lazy:false,titlePane:true,canToggle:true,onPreview:function(item){if(item)this.execute(item)},onTitlebarToggled:function(state){if(this.blockToolbar)if(!state)this.blockToolbar.clear();
else this.onItemSelected(this.currentItem)},onResize:function(){if(this.gridView)this.gridView.onResize()},onGridKeyEnter:function(){this.editBlock(this.getItem())},onGridMouseDoubleClick:function(){this.editBlock(this.getItem())},onReloaded:function(){if(this.containerNode)dojo.empty(this.containerNode);this.createdWidgets()},reload:function(){var scope=this.blockScope;var store=scope[this.storeField];this.gridView.grid.set("collection",store.filter({group:this.blockGroup}));this.gridView.refresh()},
addItem2:function(menuItem){var item=menuItem.item;if(!item)return;var target=item.target;var proto=item.proto;var ctorArgs=item.ctrArgs;var where=null;if(target&&proto&&ctorArgs){if(target.owner&&target.dstField){where=target.dstField;target=target.owner}ctorArgs["parentId"]=target.id;ctorArgs["group"]=null;ctorArgs["parent"]=target;var _newBlock=target.add(proto,ctorArgs,where);_newBlock.parent=target}else if(!target&&proto&&ctorArgs)factory.createBlock(proto,ctorArgs);this.onItemAction();this.gridView.grid.set("store",
this.blockScope.blockStore,{group:this.blockGroup})},getAddActions:function(item){var thiz=this;if(item&&item.canAdd)if(item.canAdd()==null)return null;var items=[];if(this.showAllBlocks||item){var variables=this.blockScope.getVariables();var variableItems=[];for(var i=0;i<variables.length;i++)variableItems.push({name:variables[i].title,target:item,iconClass:"el-icon-compass",proto:VariableAssignmentBlock,item:variables[i],ctrArgs:{variable:variables[i].title,scope:this.blockScope,value:"0"}});items=
factory.getAllBlocks(this.blockScope,this,item,this.blockGroup);items.push({name:"Set Variable",target:item,iconClass:"el-icon-pencil-alt",items:variableItems});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:items});return items}if(!item)if(this.newRootItemFunction){items.push({name:this.newRootItemLabel,iconClass:this.newRootItemIcon,handler:function(){thiz.newRootItemFunction();thiz.onItemAction()}});return items}},excecuteCommand:function(block){if(!block||!block.scope)return;
try{0&&console.dir(block.scope.solveBlock(block.name))}catch(e){0&&console.log(" excecuting block -  "+block.name+" failed! : "+e);0&&console.log(printStackTrace().join("\n\n"));0&&console.dir(block.scope)}},createTitlePane:function(name,options){var thiz=this;var pane=utils.addWidget(ActionTogglePane,{title:name,beanContextName:this.beanContextName,open:options["open"]!=null?options["open"]:true,lazy:options["lazy"]!=null?options["lazy"]:false,delegate:this,toggleable:options["canToggle"]!=null?
options["canToggle"]:true,actions:[]},this,this.attachTo,true);this.view=pane;this.blockToolbar=this.view.toolbar;return pane},_createVariablesStore:function(data){var sdata={identifier:"id",label:"title",items:data};var store=Observable(Memory({data:sdata}));return store},_createSettingsPane:function(lazy){var where=null;if(this.titlePane){this.settingsPane=this.createTitlePane(this.title,{open:this.open,lazy:this.lazy,canToggle:this.canToggle});where=this.settingsPane.containerNode}else{this.toolbar=
utils.addWidget(ActionToolbar,{delegate:this,beanContextName:this.beanContextName,style:"display:inline-block;min-height:30px;width:auto;",actions:[]},this,this.attachTo,true);this.blockToolbar=this.toolbar;where=this.attachTo}var store=this.blockScope[this.storeField]||this.blockStore||this.blockScope.blockStore;var _gridCtorArgs={store:store,blockScope:this.blockScope,delegate:this,beanContextName:this.beanContextName,handleContainerClick:this.handleContainerClick,clearSelection:this.clearSelection,
keyboardNavigation:this.keyboardNavigation,mouseNavigation:this.mouseNavigation};if(this.gridParams)_gridCtorArgs=lang.mixin(_gridCtorArgs,this.gridParams);var gridView=utils.addWidget(this.gridViewProto,_gridCtorArgs,this,where,true);this.gridView=gridView;this.blockStore=store;this.blockGridView=gridView;this.gridView.grid.set("collection",store.filter({group:this.blockGroup}));return this.settingsPane?this.settingsPane:null},onShow:function(evt){if(evt&&evt.view&&evt.view==this.parentContainer){if(this.gridView){this.gridView.onShow();
this.gridView.onResize()}}else if(this.gridView&&this.gridView.onShow){this.gridView.onShow();this.gridView.onResize();if(this.parentContainer)this.parentContainer.resize();this.gridView.domNode.scrollTop=0}},save:function(){if(this.delegate&&this.delegate.onSave)this.delegate.onSave(this);return;var variables=this.blockScope.variablesToJson();try{var _testData=dojo.fromJson(JSON.stringify(variables))}catch(e){console.error("invalid data");return}this.setValue(JSON.stringify(variables))},onGridDataChanged:function(evt){return null;
var item=this.store.get(evt.id);if(item)item[evt.field]=evt.newValue;this.save()},createdWidgets:function(){try{var thiz=this;this._createSettingsPane();this.registerUpdateFunction(function(){if(thiz.gridView){thiz.gridView.grid.refresh();thiz.gridView.onResize()}})}catch(e){debugger}},onBlockPropertyChanged:function(evt){if(evt&&evt.item&&evt.item.scope==this.blockScope)if(this.gridView)this.gridView.refresh()},onVariableChanged:function(){if(this.gridView)this.gridView.refresh()},startup:function(){this.inherited(arguments);
try{this.createdWidgets();if(this.blockGroup==="Variables"){var thiz=this;factory.subscribe(types.EVENTS.ON_VARIABLE_CHANGED,function(evt){thiz.onVariableChanged(evt)},thiz)}this.subscribe(types.EVENTS.ON_BLOCK_PROPERTY_CHANGED,this.onBlockPropertyChanged)}catch(e){console.error("response settings widget crashed : "+e)}}})})},"xblox/model/Statement":function(){define(["dojo/_base/declare","./Block"],function(declare,Block){return declare("xblox.model.Statement",[Block],{toText:function(){return this.name},
getChildren:function(){return this.items}})})},"xblox/model/logic/SwitchBlock":function(){define(["dojo/_base/declare","xblox/model/Block","xblox/model/logic/CaseBlock"],function(declare,Block,CaseBlock){return declare("xblox.model.SwitchBlock",[Block],{variable:"PowerState",items:null,name:"Switch",toText:function(){return this.getBlockIcon("H")+this.name+" "+this.variable},canAdd:function(){return[]},solve:function(scope,settings){var anyCase=false;var ret=[];this.onSuccess(this,settings);for(var n=
0;n<this.items.length;n++){var block=this.items[n];if(block.declaredClass==="xblox.model.logic.CaseBlock"){var caseret;caseret=block.solve(scope,this,settings);if(caseret!=false){anyCase=true;this.addToEnd(ret,caseret);break}else;}}if(!anyCase)for(var n=0;n<this.items.length;n++){var block=this.items[n];if(!(block.declaredClass=="xblox.model.logic.CaseBlock"))this.addToEnd(ret,block.solve(scope))}return ret},init:function(){},getChildren:function(parent){return this.items},postCreate:function(){this.add(CaseBlock,
{comparator:"\x3d\x3d",expression:"ON",group:null});this.add(CaseBlock,{comparator:"\x3d\x3d",expression:"Standby",group:null})}})})},"xblox/types/Types":function(){define(["xide/types/Types","dojo/_base/lang"],function(types,lang){lang.mixin(types.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",
ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_VARIABLE_CHANGED:"onVariableChanged"});types.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",
DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",
Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};return types})},"xblox/model/loops/ForBlock":function(){define(["dojo/_base/declare",
"xblox/model/Block","xblox/model/variables/Variable"],function(declare,Block,Variable){return declare("xblox.model.loops.ForBlock",[Block],{initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:true,_solve:function(scope,settings){var ret=[];for(var n=0;n<this.items.length;n++)this.addToEnd(ret,this.items[n].solve(scope,settings));return ret},solve:function(scope,settings){var ret=[];var noInfinite=true;this._counter=new Variable({title:this.counterName,
value:this.initial,scope:scope,register:false});while(this._checkCondition(scope)){this.addToEnd(ret,this._solve(scope,settings));noIfinite=this._updateCounter(scope);if(!noInfinite)break}return ret},_checkCondition:function(scope){var expression=""+this._counter.value+this.comparator+this["final"];return scope.parseExpression(expression)},_updateCounter:function(scope){var value=this._counter.value;var expression=""+value+this.modifier;var value=scope.parseExpression(expression);if(value==this._counter.value)return false;
else{this._counter.value=value;return true}},mayHaveChildren:function(parent){return this.items!=null&&this.items.length>0},getChildren:function(parent){var result=[];if(this.items)result=result.concat(this.items);return result},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var fields=[this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",
dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"})];fields=fields.concat(this.inherited(arguments));return fields}})})},"xblox/model/code/RunScript":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","xblox/model/Block",
"xide/utils"],function(declare,lang,Deferred,Block,utils){return declare("xblox.model.code.RunScript",[Block],{name:"Run Script",method:"",args:"",deferred:false,sharable:true,context:null,getContext:function(){if(this.scope.context&&this.scope.context.instance)return this.scope.context.instance;return this.context||this},solve:function(scope,settings,run,error){this._currentIndex=0;this._return=[];var _script=""+this._get("method");var thiz=this;if(_script&&_script.length){var _function=new Function("{"+
_script+"}");var _args=this.getArgs();try{var _parsed=_function.apply(this.getContext(),_args||{});this._lastResult=_parsed;if(run)run("Expression "+_script+" evaluates to "+_parsed);if(_parsed!=="false"&&_parsed!==false)this.onSuccess(this,settings);else{this.onFailed(this,settings);return[]}}catch(e){if(error)error("invalid expression : \n"+_script+": "+e);this.onFailed(this,settings);return[]}}else console.error("have no script");var ret=[],items=this[this._getContainer()];if(items.length)this.runFrom(items,
0,settings);else this.onSuccess(this,settings);this.onDidRun();return ret},toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.method)result+=this.method.substr(0,50);return result},canAdd:function(){return[]},getFields:function(){var fields=this.inherited(arguments)||this.getDefaultFields();var thiz=this;fields.push(this.utils.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));fields.push(this.utils.createCI("value",25,this.method,{group:"General",
title:"Script",dst:"method",delegate:{runExpression:function(val,run,error){var old=thiz.method;thiz.method=val;var _res=thiz.solve(thiz.scope,null,run,error)}}}));fields.push(this.utils.createCI("value",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-code"\x3e\x3c/span\x3e'},mayHaveChildren:function(parent){return this.items!=null&&this.items.length>0},getChildren:function(parent){return this.items}})})},"xblox/embedded_ui":function(){define(["xblox/embedded",
"xblox/views/BlocksFileEditor","xblox/factory/Blocks","xblox/views/GroupedBlockView","xide/widgets/ScriptWidget","xide/widgets/JSONEditorWidget","dijit/PopupMenuBarItem"],function(){})},"xblox/views/BlocksGridDndSource":function(){define(["dojo/_base/declare","dojo/dnd/Source","dojo/_base/Deferred","dojo/dnd/Manager","dojo/_base/NodeList","dojo/topic","dojo/has"],function(declare,Source,Deferred,DnDManager,NodeList,topic,has){var blockGridDndSource=declare(Source,{grid:null,hover:true,onDndCancel:function(){this.inherited(arguments);
this.hover=false;if(this.targetAnchor)this._removeItemClass(this.targetAnchor,"Hover")},onDndSourceOver:function(source){if(this!==source){this.mouseDown=false;if(this.targetAnchor)this._unmarkTargetAnchor()}else if(this.isDragging){var m=DnDManager.manager();m.canDrop(this.targetState!="Disabled"&&(!this.current||m.source!=this||!(this.current.id in this.selection)))}},_markTargetAnchorOn:function(hover){if(this.current==this.targetAnchor&&this.hover==hover)return;if(this.targetAnchor)this._removeItemClass(this.targetAnchor,
this.hover?"Hover":"");this.hover=hover;if(this.targetAnchor)this._addItemClass(this.targetAnchor,this.hover?"Hover":"")},_unmarkTargetAnchorOn:function(){if(!this.targetAnchor)return;this._removeItemClass(this.targetAnchor,"Hover");this.targetAnchor=null;this.targetBox=null;this.hover=false},getObject:function(node){var grid=this.grid;return grid.store.get(node.id.slice(grid.id.length+5))},_legalMouseDown:function(evt){var legal=this.inherited(arguments);return legal&&evt.target!=this.grid.bodyNode},
onDrop:function(sourceSource,nodes,copy){if(this.targetAnchor)this._removeItemClass(this.targetAnchor,"Hover");var targetSource=this,targetRow=this._targetAnchor=this.targetAnchor,grid=this.grid,store=grid.store;if(!this.before&&targetRow)targetRow=targetRow.nextSibling;targetRow=targetRow&&grid.row(targetRow);Deferred.when(targetRow&&store.get(targetRow.id),function(target){if(targetSource!=sourceSource)targetSource.onDropExternal(sourceSource,nodes,copy,target);else targetSource.onDropInternal(nodes,
copy,target)})},onDropInternal:function(nodes,copy,targetItem){var store=this.grid.store,targetSource=this,grid=this.grid,anchor=targetSource._targetAnchor,targetRow;if(anchor)targetRow=this.before?anchor.previousSibling:anchor.nextSibling;if(!copy&&(targetRow===nodes[0]||!targetItem&&grid.down(grid.row(nodes[0])).element==nodes[0]))return;nodes.forEach(function(node){Deferred.when(targetSource.getObject(node),function(object){store[copy&&store.copy?"copy":"put"](object,{before:targetItem})})})},
onDropExternal:function(sourceSource,nodes,copy,targetItem){var store=this.grid.store,sourceGrid=sourceSource.grid;nodes.forEach(function(node,i){Deferred.when(sourceSource.getObject(node),function(object){if(!copy)if(sourceGrid)Deferred.when(sourceGrid.store.getIdentity(object),function(id){!i&&sourceSource.selectNone();sourceSource.delItem(node.id);sourceGrid.store.remove(id)});else sourceSource.deleteSelectedNodes();store[store.copy?"copy":"put"](object,{before:targetItem})})})},onDndStart:function(source,
nodes,copy){this.inherited(arguments);if(source==this){if(this.grid.cancelTouchScroll)this.grid.cancelTouchScroll();DnDManager.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px"}},onMouseDown:function(evt){if(has("touch")&&this.isDragging&&touchUtil.countCurrentTouches(evt,this.grid.touchNode)>1){topic.publish("/dnd/cancel");DnDManager.manager().stopDrag()}else this.inherited(arguments)},onMouseMove:function(evt){if(!has("touch")||touchUtil.countCurrentTouches(evt,this.grid.touchNode)<=
1)this.inherited(arguments)},checkAcceptance:function(source,nodes){return source.getObject&&Source.prototype.checkAcceptance.apply(this,arguments)},getSelectedNodes:function(){if(!this.grid.selection)return this.inherited(arguments);var t=new NodeList,id;for(id in this.grid.selection)t.push(this._selectedNodes[id]);return t},_markTargetAnchor:function(before){if(this.current==this.targetAnchor&&this.before==before)return;if(this.targetAnchor)this._removeItemClass(this.targetAnchor,this.before?"Before":
"After");this.targetAnchor=this.current;this.targetBox=null;this.before=before;if(this.targetAnchor)this._addItemClass(this.targetAnchor,this.before?"Before":"After")}});return blockGridDndSource})},"xblox/model/Referenced":function(){define(["dojo/_base/declare","xide/mixins/ReferenceMixin"],function(declare,ReferenceMixin){return declare("xblox.model.Referenced",[ReferenceMixin],{reference:null,deserialize:function(value){if(!value||value.length==0)return{};try{return dojo.fromJson(value)}catch(e){return{}}},
referencesToNodes:function(reference){var objects=this.resolveReference(this.deserialize(reference||this.reference))}})})},"xblox/manager/BlockManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/Deferred","xide/types","xide/utils","xide/factory","xblox/model/ModelBase","xblox/model/Scope","xide/mixins/ReloadMixin","xide/manager/ManagerBase","xide/mixins/EventedMixin","xblox/data/Store","dojo/has!xblox-ui?xblox/manager/ClipboardManager","dojo/has!xblox-ui?xblox/manager/BlockManagerUI"],
function(declare,lang,has,Deferred,types,utils,factory,ModelBase,Scope,ReloadMixin,ManagerBase,EventedMixin,Store,ClipboardManager,BlockManagerUI){var blockManager=declare("xblox/manager/BlockManager",[ManagerBase,ReloadMixin],{clipboardManager:null,serviceObject:null,loaded:{},_registerActions:function(){},toScope:function(data){try{data=utils.getJson(data)}catch(e){return null}var scopeId=utils.createUUID();var blockInData=data;var variableInData=data;if(lang.isArray(data));else if(lang.isObject(data)){scopeId=
data.scopeId||scopeId;blockInData=data.blocks||[];variableInData=data.variables||[]}var blockManager=this;var scopeUserData={owner:this};var blockScope=this.getScope(scopeId,scopeUserData,true);var allBlocks=blockScope.blocksFromJson(blockInData);for(var i=0;i<allBlocks.length;i++){var obj=allBlocks[i];obj._lastRunSettings={force:false,highlight:true}}var allVariables=blockScope.variablesFromJson(variableInData);return blockScope},load:function(mount,path,forceReload){var dfd=new Deferred,thiz=this,
_mount=utils.replaceAll("/","",mount),_path=utils.replaceAll("./","",path);var full=_mount+_path;full=full.trim();if(forceReload!==true&&this.loaded[full]){dfd.resolve(this.loaded[full]);return dfd.promise}var _ready=function(data){var scope=thiz.toScope(data);if(scope)thiz.loaded[full]=scope;dfd.resolve(scope)};this.ctx.getFileManager().getContent(_mount,_path,_ready,false);return dfd.promise},getClipboardManager:function(){if(!this.clipboardManager&&ClipboardManager){this.clipboardManager=new ClipboardManager({});
this.clipboardManager.init()}return this.clipboardManager},onBlocksReady:function(scope){var blocks=scope.allBlocks();for(var i=0;i<blocks.length;i++){var obj=blocks[i];this.setScriptFunctions(obj,scope,this)}var loadBlocks=scope.getBlocks({group:"On Load"});if(loadBlocks&&loadBlocks.length>0)for(var i=0;i<loadBlocks.length;i++){var loadBlock=loadBlocks[i];if(loadBlock.onLoad)loadBlock.onLoad()}},setScriptFunctions:function(obj,scope,owner){var thiz=owner;obj.setVariable=function(title,value,save,
publish,source){var _variable=this.scope.getVariable(title);if(_variable){_variable.value=value;0&&console.log("setting variable "+title+" to "+value)}else{0&&console.log("no such variable : "+title);return}if(publish!==false)thiz.publish(types.EVENTS.ON_VARIABLE_CHANGED,{item:_variable,scope:scope,driver:obj,owner:thiz,save:save===true,source:source||types.MESSAGE_SOURCE.BLOX})};obj.getVariable=function(title){var _variable=this.scope.getVariable(title);if(_variable)return _variable.value;return""}},
scope:null,scopes:null,_createBlock:null,getScope:function(id,userData,publish){if(!this.scopes)this.scopes={};if(!this.scopes[id]){this.scopes[id]=this.createScope(id);this.scopes[id].userData=userData;if(publish!==false)try{factory.publish(types.EVENTS.ON_SCOPE_CREATED,this.scopes[id])}catch(e){}}return this.scopes[id]},removeScope:function(id){if(!this.scopes)this.scopes={};if(this.scopes[id]){this.scopes[id]._destroy();delete this.scopes[id]}return null},createScope:function(id){var varData={identifier:"id",
label:"title",items:[]};var blockData={identifier:"id",label:"title",items:[]};var blockStore=new Store({data:blockData,idProperty:"id",_getChildren:function(parent,options){if(parent.getChildren)return parent.getChildren(parent);var op=lang.mixin({},options&&options.originalQuery||null,{parentId:parent.id});var res=this.query(op,options);return res},_mayHaveChildren:function(parent){if(parent.mayHaveChildren)return parent.mayHaveChildren(parent);return parent.items!=null&&parent.items.length>0},
_query:function(query,options){return null;query=query||{};options=options||{};if(!query.parentId&&!options.deep)query.parentId=undefined;return this.queryEngine(query,options)(this.data)}});var variableStore=new Store({data:varData,idProperty:"id",_getChildren:function(parent,options){if(parent.getChildren)return parent.getChildren(parent);var op=lang.mixin({},options&&options.originalQuery||null,{parentId:parent.id});var res=this.query(op,options);return res},_mayHaveChildren:function(parent){if(parent.mayHaveChildren)return parent.mayHaveChildren(parent);
return parent.items!=null&&parent.items.length>0}});var scope=new Scope({variables:[],blocks:[],id:id,owner:this,variableStore:variableStore,blockStore:blockStore,serviceObject:this.serviceObject,config:this.config});ReloadMixin.prototype.mergeFunctions(scope,EventedMixin.prototype);ReloadMixin.prototype.mergeFunctions(scope,ReloadMixin.prototype);scope.initReload();return scope},init:function(){this.scope={variables:[],blocks:[]};ModelBase.prototype.types=types;ModelBase.prototype.factory=factory;
this.getClipboardManager();if(this.onReady)this.onReady();this.inherited(arguments)}});if(1)blockManager=blockManager.extend(BlockManagerUI.prototype);return blockManager})},"xblox/widgets/BlockGridRowEditor":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","xide/types","dijit/_Widget","xide/widgets/TemplatedWidgetBase","xide/widgets/ToolTipMixin","xide/mixins/ReloadMixin","xide/mixins/EventedMixin"],function(declare,domClass,domConstruct,types,_Widget,TemplatedWidgetBase,
ToolTipMixin,ReloadMixin,EventedMixin){return declare("xblox.widgets.BlockGridRowEditor",[_Widget,TemplatedWidgetBase,EventedMixin,ReloadMixin,ToolTipMixin],{_didRenderBlock:false,containerNode:null,debug:true,highlightDelay:200,_isHighLighting:false,textNode:null,getRootId:function(){return this.id},getTooltipNode:function(){return this.containerNode},templateString:"\x3cdiv data-dojo-attach-point\x3d'root' class\x3d'' style\x3d''\x3e"+"\x3cdiv data-dojo-attach-point\x3d'containerNode'\x3eno set\x3c/div\x3e"+
"\x3c/div\x3e",set:function(what,value){this.inherited(arguments)},get:function(what){return this.inherited(arguments)},renderBlock:function(block){var text="render block : "+block.declaredClass;if(!this.containerNode)return;dojo.empty(this.containerNode);var blockText="";if(block.toText){blockText=block.toText();var textItem=domConstruct.create("span",{innerHTML:blockText});this.containerNode.appendChild(textItem);this.textNode=textItem;if(block.enabled==false)domClass.add(textItem,"disabledBlock")}if(this.debug);
},onReloaded:function(){this._didRenderBlock=false;if(this.containerNode)dojo.empty(this.containerNode);this.renderBlock(this.object)},onRunBlock:function(evt){if(this._isHighLighting);this._isHighLighting=true;try{if(evt&&evt.callee==this.object&&this.root){domClass.remove(this.root,"failedBlock");domClass.remove(this.root,"activeBlock");domClass.remove(this.root,"successBlock");var thiz=this;domClass.add(this.root,"activeBlock");setTimeout(function(){domClass.remove(thiz.root,"activeBlock");thiz._isHighLighting=
false},this.highlightDelay)}}catch(e){}},onRunBlockFailed:function(evt){if(this._isHighLighting);this._isHighLighting=true;try{if(evt&&evt.callee==this.object&&this.root){domClass.remove(this.root,"failedBlock");domClass.remove(this.root,"activeBlock");domClass.remove(this.root,"successBlock");var thiz=this;domClass.add(this.root,"failedBlock");setTimeout(function(){domClass.remove(thiz.root,"failedBlock");thiz._isHighLighting=false},this.highlightDelay)}}catch(e){}},onRunBlockSuccess:function(evt){if(this._isHighLighting);
this._isHighLighting=true;try{if(evt&&evt.callee==this.object&&this.root){domClass.remove(this.root,"failedBlock");domClass.remove(this.root,"activeBlock");domClass.remove(this.root,"successBlock");var thiz=this;domClass.add(this.root,"successBlock");setTimeout(function(){domClass.remove(thiz.root,"successBlock");thiz._isHighLighting=false},this.highlightDelay)}}catch(e){}},startup:function(){this.inherited(arguments);if(!this._didRenderBlock)if(this.object){this.renderBlock(this.object);this.initToolTip(this.object.description)}else console.error("have no object!!!");
this._didRenderBlock=true;this.initReload();this.subscribe(types.EVENTS.ON_RUN_BLOCK,this.onRunBlock);this.subscribe(types.EVENTS.ON_RUN_BLOCK_FAILED,this.onRunBlockFailed);this.subscribe(types.EVENTS.ON_RUN_BLOCK_SUCCESS,this.onRunBlockSuccess)}})})},"xblox/main":function(){define(["dojo/_base/kernel"],function(){return dojo.xblox})},"xblox/widgets/AddBlockWidget":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/dom-class","dojo/on","xide/widgets/TemplatedWidgetBase","xfile/types/Types",
"xide/factory","dijit/MenuItem","dijit/MenuSeparator","dojo/aspect"],function(declare,html,domClass,on,TemplatedWidgetBase,types,factory,MenuItem,MenuSeparator,aspect){return declare("xblocks.widgets.AddBlockWidget",[TemplatedWidgetBase],{wButton:null,wThumb:null,wList:null,wTree:null,layout:null,menu:null,_didCreateDefaultItems:false,addJQueryClasses:true,menuItems:null,firstItem:null,templateString:"\x3cdiv\x3e\x3cdiv class\x3d'addBlockSelector' data-dojo-type\x3d'dijit.form.DropDownButton' data-dojo-props\x3d\"iconClass:'el-icon-plus-sign'\" data-dojo-attach-point\x3d'wButton'\x3e"+
"\x3cspan\x3e\x3c/span\x3e"+"\x3cdiv data-dojo-attach-point\x3d'menu' data-dojo-type\x3d'dijit.Menu' style\x3d'display: none;'\x3e"+"\x3c/div\x3e"+"\x3c/div\x3e"+"\x3c/div\x3e",_patchMenu:function(widget){var thiz=this;aspect.after(widget,"onOpen",function(){if(this._popupWrapper&&this._popupWrapper){var dst=this._popupWrapper;domClass.add(dst,"ui-widget ui-widget-content")}})},open:function(){this.wButton.domNode.focus();this.wButton.openDropDown();if(this.firstItem)this.firstItem.focus()},postMixInProperties:function(){this.inherited(arguments)},
_defaultItems:function(){var items=[];return items},onMenuItemClick:function(menuItem){if(menuItem.item.handler){menuItem.item.handler();return}try{this.delegate.addItem(menuItem)}catch(e){debugger}},fixButton:function(button){if(button&&button.iconNode){domClass.add(button.domNode,"ui-menu-item");domClass.remove(button.iconNode,"dijitReset");domClass.add(button.iconNode,"actionToolbarButtonElusive")}},_addHandler:function(menuItem,item){var thiz=this;dojo.connect(menuItem,"onClick",function(){thiz.onMenuItemClick(menuItem)})},
createMenuItem:function(itemData,index){var icon=itemData.icon||itemData.iconClass||"fileSelectDiscIcon";var subItems=itemData.items;var thiz=this;if(subItems&&subItems.length>0){var pSubMenu=new dijit.Menu({parentMenu:this.menu});this._patchMenu(pSubMenu);for(var i=0;i<subItems.length;i++){var subItem=new MenuItem({item:subItems[i],iconClass:subItems[i].iconClass,label:subItems[i].name,owner:itemData});pSubMenu.addChild(subItem);this._addHandler(subItem,subItems[i])}this.menu.addChild(new dijit.PopupMenuItem({label:itemData.label||
itemData.name,popup:pSubMenu,iconClass:icon}));return pSubMenu}else{var menuItem=new MenuItem({item:itemData,iconClass:icon,label:itemData.label||itemData.name});this.menu.addChild(menuItem);dojo.connect(menuItem,"onClick",function(){thiz.onMenuItemClick(menuItem)});this.fixButton(menuItem);return menuItem}},_createDefaultItems:function(){this.menuItems=[];this.firstItem=null;var actions=this.delegate.getAddActions(this.item)||this._defaultItems();for(var i=0;i<actions.length;i++){var menuItem=this.createMenuItem(actions[i],
i+1);if(!this.firstItem)this.firstItem=menuItem;this.menuItems.push(menuItem)}this.wButton.set("disabled",!(actions&&actions.length>0));this._didCreateDefaultItems=true},onOpen:function(){if(!this._didCreateDefaultItems)this._createDefaultItems()},startup:function(){try{this.inherited(arguments);if(!this._didCreateDefaultItems)this._createDefaultItems();if(this.addJQueryClasses)domClass.add(this.menu.containerNode,"addBlockMenu ui-widget ui-widget-content ui-corner-all");this.fixButton(this.wButton);
this._patchMenu(this.menu)}catch(e){debugger}}})})},"xblox/widgets/DojoDndMixin":function(){define(["dojo/_base/declare","dojo/_base/array","dijit/registry","dojo/topic"],function(declare,array,registry,topic){return declare("xblox.widgets.DojoDndMixin",null,{dropEvent:"/dnd/drop",dragEvent:"/dnd/start",overEvent:"/dnd/source/over",_eDrop:false,isDragging:false,didInit:false,_calcNewItemList:function(items){var res=[];if(items)for(var i=0;i<items.length;i++){var widget=registry.getEnclosingWidget(items[i].item.node);
if(widget){widget.item.dndCurrentIndex=i;res.push(widget)}}return res},_onOver:function(node,source){if(this.isDragging){var widget=null;if(source)widget=registry.getEnclosingWidget(source[0]);0&&console.log("on over : ")}},_onDrag:function(node,source){this.isDragging=true},checkAcceptance:function(sources,nodes){return false;if(!sources||!nodes)return;this.setupDND();var node=nodes[0];var row=this.grid.row(node);if(!row||!row.data)return;var item=row.data;0&&console.log("acce : "+item.name);return true},
onDrop:function(source,nodes,copy,target){if(!source||!nodes)return;this.isDragging=false;var node=nodes[0];var item=null;var dstItem=null;var isTree=false;var didNonTree=false;var didTree=false;if(source.tree&&source.anchor&&source.anchor.item&&target){item=source.anchor.item;isTree=true;var dstNode=target.current;if(!dstNode){0&&console.warn("have dstNode in target.current");if(this.delegate&&this.delegate.onDrop){0&&console.log("drop on nothing");this.delegate.onDrop(item,{parentId:null},false,
this.grid,source.targetState,false)}return}var dstRow=this.grid.row(dstNode);if(!dstRow){0&&console.warn("have now row");return}dstItem=dstRow.data;if(!dstItem){0&&console.warn("have no dstItem");return}try{if(this.delegate&&this.delegate.onDrop){this.delegate.onDrop(item,dstItem,target.before,this.grid,source.targetState,target.hover);didTree=true}}catch(e){debugger}}else{var row=this.grid.row(node);if(!row||!row.data)return;item=row.data;var dstNode=source.current;if(!dstNode){0&&console.warn("have dstNode in source.current");
return}var dstRow=this.grid.row(dstNode);if(!dstRow){0&&console.warn("have now row");return}dstItem=dstRow.data;if(!dstItem){0&&console.warn("have no dstItem");return}try{if(this.delegate&&this.delegate.onDrop){this.delegate.onDrop(item,dstItem,source.before,this.grid,source.sourceState,source.hover);didNonTree=true}}catch(e){debugger}}if(didNonTree==false&&didTree==false){0&&console.dir(arguments);0&&console.log("something wrong")}else{0&&console.dir(arguments);0&&console.log("droping : "+item.name+
" into "+dstItem.name+" before \x3d "+source.before);0&&console.log("didNonTree "+didNonTree+" didTree "+didTree)}},_onDrop:function(source,nodes,copy,target){},setupDND:function(){var thiz=this;if(this.didInit)return;this.didInit=true;topic.subscribe(this.dragEvent,function(node,targetArea,indexChild){thiz._onDrag(node,targetArea,indexChild)});if(this.overEvent)topic.subscribe(this.overEvent,function(node,targetArea,indexChild){thiz._onOver(node,targetArea,indexChild)});topic.subscribe(this.dropEvent,
function(source,nodes,copy,target){thiz._onDrop(source,nodes,copy,target)})}})})},"xblox/model/variables/Variable":function(){define(["dojo/_base/declare","xblox/model/Block","xide/utils"],function(declare,Block,utils){return declare("xblox.model.variables.Variable",[Block],{title:null,type:null,value:null,register:true,readOnly:false,getValue:function(){return this.value},canDisable:function(){return false},constructor:function(arguments){for(var prop in arguments)if(arguments.hasOwnProperty(prop))this[prop]=
arguments[prop];if(!this.id)this.id=this.createUUID();this.utils=utils;if(this.scope&&this.register!==false)this.scope.registerVariable(this)},canMove:function(){return false},getIconClass:function(){return"el-icon-quotes-alt"},solve:function(){var _result=this.scope.parseExpression(this.getValue(),true);0&&console.log("resolved variable "+this.title+" to "+_result);return[]},getFields:function(){var fields=this.getDefaultFields();fields.push(this.utils.createCI("title",13,this.title,{group:"General",
title:"Name",dst:"title"}));var thiz=this;fields.push(this.utils.createCI("value",25,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(val,run,error){return thiz.scope.expressionModel.parse(thiz.scope,val,false,run,error)}}}));return fields}})})},"xblox/model/functions/CallBlock":function(){define(["dojo/_base/declare","xblox/model/Block"],function(declare,Block){return declare("xblox.model.functions.CallBlock",[Block],{command:"PowerStandby",solve:function(scope,
settings){if(this.command){this.onRun(this,settings);return scope.solveBlock(this.command)}},toText:function(){return this.getBlockIcon("D")+"Call Command : "+this.command},getFields:function(){var fields=this.inherited(arguments);fields.push(this.utils.createCI("value",3,this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions()}));return fields}})})},"xblox/model/code/RunBlock":function(){define(["dojo/_base/declare","xblox/model/Block","xide/utils","xide/types"],
function(declare,Block,utils,types){return declare("xblox.model.code.RunBlock",[Block],{name:"Run Block",file:"",method:"",args:"",sharable:true,block:"",description:"Runs another Block",getContext:function(){if(this.scope.context&&this.scope.context.instance)return this.scope.context.instance;return null},solve:function(scope,settings){var context=this.getContext();if(context&&context[this.method]!=null){var res=[];var _fn=context[this.method];try{var _args=this._getArgs();var _res=_fn.apply(context,
_args||[]);res=_res;this.onSuccess(this,settings);return res}catch(e){console.error("call method failed");this.onFailed(this,settings)}}else{this.onFailed(this,settings);return[]}return[]},toText:function(){var result=this.getBlockIcon()+" "+this.name+" ";if(this.method)result+=this.method.substr(0,20);return result},getFields:function(){var fields=this.inherited(arguments);fields.push(this.utils.createCI("Block",types.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",
group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));fields.push(this.utils.createCI("File",types.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:false,acceptFolders:false,acceptFiles:true,encodeFilePath:false,buildFullPath:true,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:false,globalPanelMixin:{allowLayoutCookies:false}},configMixin:{beanContextName:this.id,
LAYOUT_PRESET:types.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:false,ALLOW_NEW_TABS:true,ALLOW_MULTI_TAB:false,ALLOW_INFO_VIEW:true,ALLOW_LOG_VIEW:false,ALLOW_CONTEXT_MENU:true,ALLOW_LAYOUT_SELECTOR:true,ALLOW_SOURCE_SELECTOR:true,ALLOW_COLUMN_RESIZE:true,ALLOW_COLUMN_REORDER:true,ALLOW_COLUMN_HIDE:true,ALLOW_ACTION_TOOLBAR:true,ALLOW_BREADCRUMBS:false}},defaultStoreOptions:{"fields":1663,"includeList":"xblox","excludeList":"*"},startPath:this.file}}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},
"xblox/model/ModelBase":function(){define(["dojo/_base/declare","xide/utils"],function(declare,utils){return declare("xblox.model.ModelBase",null,{id:null,description:"",parent:null,parentId:null,group:null,order:0,constructor:function(arguments){for(var prop in arguments)if(arguments.hasOwnProperty(prop))this[prop]=arguments[prop];if(!this.id)this.id=this.createUUID();this.utils=utils},keys:function(a){var b=[];for(var c in a)b.push(c);return b},values:function(b){var a=[];for(var c in b)a.push(b[c]);
return a},toArray:function(){return this.map()},size:function(){return this.toArray().length},createUUID:function(){var S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()},canEdit:function(){return true},getFields:function(){return null},isString:function(a){return typeof a=="string"},isNumber:function(a){return typeof a=="number"},isBoolean:function(a){return typeof a=="boolean"},isObject:function(a){return typeof a===
"object"},isArray:function(a){if(Array.isArray)return Array.isArray(a);return false},getValue:function(val){var _float=parseFloat(val);if(!isNaN(_float))return _float;if(val==="true"||val===true)return true;if(val==="false"||val===false)return false;return val},isScript:function(val){return this.isString(val)&&val.indexOf("@")==-1&&(val.indexOf("return")!=-1||val.indexOf(";")!=-1||val.indexOf("+")!=-1||val.indexOf("-")!=-1||val.indexOf("\x3c")!=-1||val.indexOf("*")!=-1||val.indexOf("/")!=-1||val.indexOf("%")!=
-1||val.indexOf("\x3d")!=-1||val.indexOf("\x3e")!=-1||val.indexOf("[")!=-1||val.indexOf("{")!=-1||val.indexOf("}")!=-1)},replaceAll:function(find,replace,str){if(this.isString(str))return str.split(find).join(replace);return str},isInValidState:function(){return true}})})},"xblox/views/BlockTreeView":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/Tree","xide/views/BeanView","xide/views/BeanTreeView","xide/factory","xide/types","dojo/store/Memory","dojo/store/Observable","dijit/tree/ObjectStoreModel",
"dijit/tree/dndSource"],function(declare,domClass,Tree,BeanView,BeanTreeView,factory,types,Memory,Observable,ObjectStoreModel,dndSource){return declare("xblox.views.BlockTreeView",[BeanView,BeanTreeView],{model:null,store:null,tree:null,currentItem:null,pMenu:null,pMenuContextItem:null,currentInsertionNode:null,newItemData:null,didLoad:false,selectable:false,rootLabel:"",reCreateStore:true,beanType:null,hasItemActions:function(){return false},onReloaded:function(){this.initWidgets()},_createTreeStore:function(blockData){var data=
{items:blockData,identifier:"name",label:"name"};return Observable(new Memory({data:data,getChildren:function(object){return object.items},mayHaveChildren:function(parent){return parent.items!=null&&parent.items.length>0}}))},initWidgets:function(){dojo.empty(this.containerNode);var items=[];items=factory.getAllBlocks(null,this,null,null);factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST_END,{items:items});this.store=this._createTreeStore(items);var SharedDndGridSource=declare([dndSource],{onDrop:function(sourceSource,
nodes,copy){0&&console.log("drp",sourceSource);0&&console.log("drp2",nodes)}});var root={name:"Root",items:items};var model=new ObjectStoreModel({store:this.store,root:root,mayHaveChildren:function(parent){return parent.items!=null&&parent.items.length>0}});var itemTreeCheckItemAcceptance=function(node,source,position){return true};var collectionTreeCheckItemAcceptance=function(node,source,position){return false};var dndAccept=function(source,nodes){return true};var tree=(new Tree({showRoot:false,
model:model,dndController:SharedDndGridSource,checkAcceptance:dndAccept,checkItemAcceptance:itemTreeCheckItemAcceptance,dragThreshold:8,betweenThreshold:5,getIconClass:function(item,opened){var iclass=!item||this.model.mayHaveChildren(item)?opened?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf";if(item&&item.iconClass!=null)return item.iconClass;return iclass},persist:false})).placeAt(this.containerNode);tree.startup();domClass.add(tree.domNode,"ui-widget");domClass.add(tree.domNode,"ui-state-default");
this.resize()},startup:function(){if(this.didLoad)return;this.inherited(arguments);this.initWidgets();this.didLoad=true}})})},"xblox/model/variables/VariableSwitch":function(){define(["dojo/_base/declare","xblox/model/logic/SwitchBlock"],function(declare,SwitchBlock){return declare("xblox.model.variables.VariableSwitch",[SwitchBlock],{name:"Switch on Variable",toText:function(){return this.getBlockIcon("H")+this.name+" "+this.variable},getFields:function(){var fields=[this.utils.createCI("Variable",
3,this.variable,{group:"General",options:this.scope.getVariablesAsOptions(),dst:"variable"})];fields=fields.concat(this.inherited(arguments));return fields}})})},"xblox/views/BlocksGridView":function(){define(["dojo/_base/declare","xide/types","xide/views/GridView"],function(declare,types,GridView){return declare("xblox.views.BlocksGridView",[GridView],{onShow:function(){this.inherited(arguments);this.publish(types.EVENTS.RESIZE)},deleteItem:function(){if(this.delegate&&this.delegate.removeItem)this.delegate.removeItem()},
onGridCreated:function(grid){this.inherited(arguments)},onClipBoardCopy:function(){var selection=this.getCurrentSelection();if(selection){var struct={items:selection,type:types.ITEM_TYPE.BLOCK,owner:this};this.publish(types.EVENTS.ON_CLIPBOARD_COPY,struct,this.delegate)}},onClipBoardPaste:function(){this.publish(types.EVENTS.ON_CLIPBOARD_PASTE,{owner:this,type:types.ITEM_TYPE.BLOCK},this.delegate)},onClipBoardCut:function(){var selection=this.getCurrentSelection();if(selection){var struct={items:selection,
owner:this,type:types.ITEM_TYPE.BLOCK};this.publish(types.EVENTS.ON_CLIPBOARD_CUT,struct,this.delegate)}}})})},"xblox/model/server/ServerBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","xblox/model/Block","xide/utils"],function(declare,lang,Deferred,Block,utils){return declare("xblox.model.server.ServerBlock",[Block],{name:"Run Server Block",method:"XShell::run",args:"",deferred:true,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:true,onReloaded:function(){var service=
this.getService();var params=service.getParameterMap(this.getServiceClass(),this.getServiceMethod());0&&console.log("params",params);var cwd="root://test";var cmd="ls";var fun=this.getServerFunction(),thiz=this;if(fun){var _cb=function(response){0&&console.log("hello from server",response)};var _value=service.base64_encode(cmd);service.callMethodEx(this.getServiceClass(),"run",["sh",_value,cwd],_cb)}},solve:function(scope,settings,run,error){this._currentIndex=0;this._return=[];var _script=""+this.method;
var thiz=this;if(_script&&_script.length){var _function=new Function("{"+_script+"}");var _args=this.getArgs();try{var _parsed=_function.apply(this,_args||{});this._lastResult=_parsed;if(run)run("Expression "+_script+" evaluates to "+_parsed);if(_parsed!=="false"&&_parsed!==false)this.onSuccess(this,settings);else{this.onFailed(this,settings);return[]}}catch(e){if(error)error("invalid expression : \n"+_script+": "+e);this.onFailed(this,settings);return[]}}else console.error("have no script");var ret=
[],items=this[this._getContainer()];if(items.length)this.runFrom(items,0,settings);else this.onSuccess(this,settings);return ret},toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.method)result+=this.method.substr(0,50);return result},canAdd:function(){return[]},getServerDefaultFields:function(target){var fields=target||[];fields.push(this.utils.createCI("args",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return fields},getFields:function(){var fields=
this.inherited(arguments)||this.getDefaultFields();var thiz=this;return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(parent){return this.items!=null&&this.items.length>0},getChildren:function(parent){return this.items},isInValidState:function(){return this.getService()!=null},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||
this.defaultServiceMethod},hasMethod:function(method){return this.isInValidState()&&this.getService()[this.getServiceClass()]!=null&&this.getService()[this.getServiceClass()][this.getServiceMethod()]!=null},hasServerClass:function(_class){return this.isInValidState()&&this.getService()[this.getServiceClass()]!=null},getServerFunction:function(){if(this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod())return this.getService()[this.getServiceClass()][this.getServiceMethod()];return null}})})},
"xblox/component":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/has","xide/model/Component","xide/types","require"],function(declare,Deferred,has,Component,types,require){return declare([Component],{beanType:"BLOCK",_load:function(){},hasEditors:function(){return["xblox"]},getDependencies:function(){if(1)return["xide/xide","xblox/types/Types","xblox/manager/BlockManager","xblox/manager/BlockManagerUI","xblox/embedded_ui","xfile/manager/BlockManager","xfile/views/BlocksFileEditor",
"xide/widgets/ExpressionJavaScript","xide/widgets/ImageWidget","xide/widgets/Expression","xide/widgets/ArgumentsWidget","xide/widgets/RichTextWidget","xide/widgets/JSONEditorWidget","xide/widgets/ExpressionEditor","xide/widgets/WidgetReference","xide/widgets/DomStyleProperties","xide/widgets/BlockPickerWidget","xide/widgets/BlockSettingsWidget"];else return["xide/xide","xblox/types/Types","xblox/manager/BlockManager","xblox/embedded"]},getLabel:function(){return"xblox"},getBeanType:function(){return this.beanType}})})},
"xblox/data/Store":function(){define(["dojo/_base/declare","dstore/Memory","dstore/Tree","xide/data/_Base"],function(declare,Memory,Tree,_Base){return declare("xblox/data/Store",[Memory,Tree,_Base],{reset:function(){this._state.filter=null;this.resetQueryLog()},_state:{filter:null},resetQueryLog:function(){this.queryLog=[]},fetch:function(){return this.fetchSync()},filter:function(data){var _res=this.inherited(arguments);this._state.filter=data;return _res},fetchRange:function(kwArgs){var _res=this.fetchRangeSync(kwArgs);
if(this._state.filter){if(this._state.filter["parent"]){var _item=this.getSync(this._state.filter.parent);if(_item){this.reset();return _item.items}}if(this._state.filter["group"]){var _items=this.getSync(this._state.filter.parent);if(_item){this.reset();return _item.items}}}return _res},getChildren:function(parent,options){var _res=this.inherited(arguments);return _res},mayHaveChildren:function(parent){if(parent.mayHaveChildren)return parent.mayHaveChildren(parent);return parent.items!=null&&parent.items.length>
0}})})},"xblox/model/code/CallMethod":function(){define(["dojo/_base/declare","xblox/model/Block","xide/utils"],function(declare,Block,utils){return declare("xblox.model.code.CallMethod",[Block],{name:"Call Method",method:"",args:"",sharable:true,getContext:function(){if(this.scope.context&&this.scope.context.instance)return this.scope.context.instance;return null},_getArg:function(val){var _float=parseFloat(val);if(!isNaN(_float))return _float;else{if(val==="true"||val==="false")return utils.toBoolean(val);
return val}return val},_getArgs:function(){var result=utils.getJson(this.args);if(result!=null&&this.isArray(result))return result;if(this.isString(this.args)){var result=[];if(this.args.indexOf(",")!==-1){var _splitted=this.args.split(",");for(var i=0;i<_splitted.length;i++){var _float=parseFloat(_splitted[i]);if(!isNaN(_float))result.push(_float);else if(_splitted[i]==="true"||_splitted[i]==="false")result.push(utils.toBoolean(_splitted[i]));else result.push(_splitted[i])}return result}else return[this._getArg(this.args)]}return null},
solve:function(scope,settings){var context=this.getContext();if(context&&context[this.method]!=null){var res=[];var _fn=context[this.method];try{var _args=this._getArgs();var _res=_fn.apply(context,_args||[]);res=_res;this.onSuccess(this,settings);return res}catch(e){console.error("call method failed");this.onFailed(this,settings)}}else{this.onFailed(this,settings);return[]}return[]},toText:function(){var result=this.getBlockIcon()+" "+this.name+" ";if(this.method)result+=this.method.substr(0,20);
return result},getFields:function(){var fields=this.inherited(arguments);fields.push(this.utils.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));fields.push(this.utils.createCI("value",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnKey":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/Deferred",
"xblox/model/Block","xide/utils","xide/types","xide/mixins/EventedMixin","xblox/model/Referenced","xblox/model/Contains","xblox/model/events/OnEvent","dijit/registry","dojo/on"],function(declare,lang,array,Deferred,Block,utils,types,EventedMixin,Referenced,Contains,OnEvent,registry,on){return declare("xblox.model.events.OnKey",[Block,EventedMixin,Referenced,Contains],{name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",
listeners:null,sharable:true,toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.event)result+=this.event;return result},canAdd:function(){return[]},getFields:function(){var fields=this.inherited(arguments)||this.getDefaultFields();fields.push(this.utils.createCI("Keyboard Sequence",types.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:false}));fields.push(this.utils.createCI("Object/Widget",types.ECIType.WIDGET_REFERENCE,this.reference,
{group:"General",dst:"reference",value:this.reference}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(evt){this._lastResult=evt;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(keys,handler,obj){if(this.listeners==null)this.listeners=[];var my_defaults={is_unordered:true,prevent_repeat:false,prevent_default:false,on_keyup:function(e){0&&console.log("up")},on_keydown:function(e){0&&console.log("down")},on_release:function(e){0&&
console.log("release")}};var listener=null;listener=new window.keypress.Listener(obj,my_defaults);listener.simple_combo(keys,function(e){if(handler)handler(arguments)});this.listeners.push(listener)},_subscribe:function(keys,handler,obj){if(!keys)return;if(obj&&obj.domNode)obj=obj.domNode;this._addListerner(keys,handler,obj)},_registerEvent:function(evt){if(!evt||!evt.length)return;var objects=this.resolveReference(this.deserialize(this.reference));var thiz=this;if(objects&&objects.length)for(var i=
0;i<objects.length;i++){var obj=objects[i];if(obj&&obj.id){var _widget=registry.byId(obj.id);_widget=null;if(_widget&&_widget.on){var _event=this.event.replace("on","");var _handle=_widget.on(_event,lang.hitch(this,function(e){thiz.onEvent(e)}));this._events.push(_handle)}else this._subscribe(evt,function(){thiz.onEvent(arguments)},obj)}else this._subscribe(evt,function(){thiz.onEvent(arguments)},obj)}else this._subscribe(evt,function(){thiz.onEvent(arguments)})},onLoad:function(){this._onLoaded=
true;if(this.event&&this.event.length&&this.enabled)this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(objects,cis){var options=[];if(!objects||!objects.length)options=this.scope.getEventsAsOptions(this.event);else{options=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},
{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}];for(var i=0;i<options.length;i++){var obj=options[i];if(obj.value===this.event){obj.selected=true;break}}}for(var i=0;i<cis.length;i++){var ci=cis[i];if(ci["widget"]&&ci["widget"].title==="Event"){var widget=ci["_widget"];widget.nativeWidget.set("options",
options);widget.nativeWidget.reset();widget.nativeWidget.set("value",this.event);this.publish(types.EVENTS.RESIZE,{});break}}},onReferenceChanged:function(newValue,cis){this._destroy();this.reference=newValue;var objects=this.resolveReference(this.deserialize(newValue));this._registerEvent(this.event)},onChangeField:function(field,newValue,cis){if(field=="event"){this._destroy();if(this._onLoaded){this.event=newValue;this._registerEvent(newValue)}}if(field=="reference")this.onReferenceChanged(newValue,
cis);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var i=0;i<this.listeners.length;i++){var obj=this.listeners[i];obj.stop_listening();var combos=obj.get_registered_combos();if(combos)obj.unregister_many(combos);obj.reset();0&&console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(block,cis){}})})},"xblox/embedded":function(){define(["dojo/_base/declare",
"xide/types","xblox/types/Types","xide/factory","xide/utils","xide/mixins/ReloadMixin","xide/mixins/EventedMixin","xblox/model/logic/CaseBlock","xblox/model/Block","xblox/model/functions/CallBlock","xblox/model/code/CallMethod","xblox/model/code/RunScript","xblox/model/code/RunBlock","xblox/model/loops/ForBlock","xblox/model/loops/WhileBlock","xblox/model/variables/VariableAssignmentBlock","xblox/model/logic/IfBlock","xblox/model/logic/ElseIfBlock","xblox/model/logic/SwitchBlock","xblox/model/variables/VariableSwitch",
"xblox/model/events/OnEvent","xblox/model/events/OnKey","xblox/model/logging/Log","xblox/manager/BlockManager","xblox/factory/Blocks"],function(){if(!Array.prototype.remove)Array.prototype.remove=function(){var what,a=arguments,L=a.length,ax;while(L&&this.length){what=a[--L];if(this.indexOf==null)break;while((ax=this.indexOf(what))!=-1)this.splice(ax,1)}return this};if(!Array.prototype.swap)Array.prototype.swap=function(x,y){var b=this[x];this[x]=this[y];this[y]=b;return this};if(typeof String.prototype.startsWith!=
"function")String.prototype.startsWith=function(str){return this.substring(0,str.length)===str};if(typeof String.prototype.endsWith!="function")String.prototype.endsWith=function(str){return this.substring(this.length-str.length,this.length)===str};if(!Function.prototype.bind)Function.prototype.bind=Function.prototype.bind||function(that){return dojo.hitch(that,this)}})},"xblox/model/Scope":function(){define(["dojo/_base/declare","dojo/_base/lang","./ModelBase","./Expression","./variables/Variable",
"xide/factory","xide/utils","xide/types","dojo/store/Memory","dojo/store/Observable","xide/mixins/ReloadMixin"],function(declare,lang,ModelBase,Expression,Variable,factory,utils,types,Memory,Observable,ReloadMixin){return declare("xblox.model.Scope",[ModelBase,ReloadMixin],{context:null,serviceObject:null,getService:function(){return this.serviceObject},blockStore:null,variableStore:null,clearCache:function(){this.expressionModel.expressionCache={};this.expressionModel.variableFuncCache={}},getVariableStore:function(){return this.variableStore},
getBlockStore:function(){return this.blockStore},getVariables:function(query){if(!this.variableStore)return[];query=query||{id:/\S+/};return this.variableStore.query(query)},loopBlock:function(block){if(block&&block.auto>0){var thiz=this;setTimeout(function(){block.solve(thiz);thiz.loopBlock(block)},block.auto)}},getEventsAsOptions:function(selected){var result=[];for(var e in types.EVENTS){var label=types.EVENTS[e];var item={label:label,value:types.EVENTS[e]};result.push(item)}result=result.concat([{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(var i=0;i<result.length;i++){var obj=
result[i];if(obj.value===selected){obj.selected=true;break}}return result},getVariablesAsOptions:function(){var variables=this.getVariables();var result=[];if(variables)for(var i=0;i<variables.length;i++)result.push({label:variables[i].title,value:variables[i].title});return result},getCommandsAsOptions:function(){var items=this.getBlocks({declaredClass:"xcf.model.Command"});var result=[];if(items)for(var i=0;i<items.length;i++)result.push({label:items[i].name,value:items[i].name});return result},
getBlocks:function(query){if(!this.blockStore)return[];query=query||{id:/\S+/};return this.blockStore.query(query)},declaredClass:"xblox.model.Scope",expressionModel:new Expression,registerVariable:function(variable){this.variables[variable.title]=variable;if(this.variableStore)this.variableStore.put(variable)},getVariable:function(title){var _var=this.variableStore.data[title];if(_var)return _var;var _var=this.variableStore.query({title:title});if(_var)return _var[0];console.error("couldnt find variable with name "+
title);return null},registerBlock:function(block){if(block.id)this.blocks[block.id]=block;if(this.blockStore){var added=this.blockStore.getSync(block.id);if(added)return;if(block.addToStore)block.addToStore(this.blockStore);else this.blockStore.putSync(block)}},allBlocks:function(block){var result=[];for(var b in this.blocks)if(this.blocks[b].id!=null)result.push(this.blocks[b]);return result},hasGroup:function(group){var all=this.allGroups();for(var i=0;i<all.length;i++){var obj=all[i];if(obj===
group)return true}return false},allGroups:function(){var result=[];var all=this.allBlocks();var _has=function(what){for(var i=0;i<result.length;i++)if(result[i]===what)return true;return false};for(var i=0;i<all.length;i++){var obj=all[i];if(obj.parentId)continue;if(obj.group){if(!_has(obj.group))result.push(obj.group)}else if(!_has("No Group"))result.push("No Group")}return result},variablesToJson:function(){var result=[];var data=this.variableStore?this.variableStore.data:this.variables;for(var e in data){var variable=
data[e];if(variable.serializeMe===false)continue;if(variable.keys==null)continue;var varOut={};for(var prop in variable)if(this.isString(variable[prop])||this.isNumber(variable[prop])||this.isBoolean(variable[prop]))varOut[prop]=variable[prop];result.push(varOut)}return result},isScript:function(val){return this.isString(val)&&(val.indexOf("return")!=-1||val.indexOf(";")!=-1||val.indexOf("[")!=-1||val.indexOf("{")!=-1||val.indexOf("}")!=-1)},variablesToJavascriptEx:function(skipVariable,expression){var result=
[];var data=this.variableStore?this.variableStore.data:this.variables;for(var i=0;i<data.length;i++){var _var=data[i];if(_var==skipVariable)continue;var _varVal=""+_var.value;if(skipVariable&&skipVariable.value&&skipVariable.value.indexOf(_var.title)==-1)continue;if(expression&&expression.indexOf(_var.title)==-1)continue;if(_varVal.length==0)continue;if(!this.isScript(_varVal)&&_varVal.indexOf("'")==-1)_varVal="'"+_varVal+"'";else if(this.isScript(_varVal))_varVal=this.expressionModel.parseVariable(this,
_var);if(_varVal==="''")_varVal="'0'";result.push(_varVal)}return result},variablesToJavascript:function(skipVariable,expression){var result="";var data=this.variableStore?this.variableStore.data:this.variables;for(var i=0;i<data.length;i++){var _var=data[i];if(_var==skipVariable)continue;var _varVal=""+_var.value;if(skipVariable&&skipVariable.value&&skipVariable.value.indexOf(_var.title)==-1)continue;if(expression&&expression.indexOf(_var.title)==-1)continue;if(_varVal.length==0)continue;if(!this.isScript(_varVal)&&
_varVal.indexOf("'")==-1)_varVal="'"+_varVal+"'";else if(this.isScript(_varVal))_varVal=this.expressionModel.parseVariable(this,_var);if(_varVal==="''")_varVal="'0'";result+="var "+_var.title+" \x3d "+_varVal+";";result+="\n"}return result},variablesFromJson:function(data){var result=[];for(var i=0;i<data.length;i++){var variable=data[i];variable["scope"]=this;if(!variable.declaredClass){0&&console.log("   variable has no class ");continue}var _class=utils.replaceAll(".","/",variable.declaredClass);
var variableClassProto=require(_class);if(!variableClassProto){0&&console.log("couldnt resolve "+_class);continue}result.push(new variableClassProto(variable))}return result},regenerateIDs:function(blocks){var thiz=this;var updateChildren=function(block){var newId=utils.createUUID();var children=thiz.getBlocks({parentId:block.id});if(children&&children.length>0)for(var i=0;i<children.length;i++){var child=children[i];child.parentId=newId;updateChildren(child)}block.id=newId};for(var i=0;i<blocks.length;i++){var block=
blocks[i];updateChildren(block)}},cloneBlocks2:function(blocks,forceGroup){var blocksJSON=this.blocksToJson(blocks);var tmpScope=this.owner.getScope(utils.createUUID(),null,false);var newBlocks=tmpScope.blocksFromJson(blocksJSON,false);newBlocks=tmpScope.allBlocks();tmpScope.regenerateIDs(newBlocks);blocksJSON=tmpScope.blocksToJson(newBlocks);if(forceGroup)for(var i=0;i<blocksJSON.length;i++){var block=blocksJSON[i];if(block.parentId==null)block.group=forceGroup}newBlocks=this.blocksFromJson(blocksJSON);
return newBlocks},cloneBlocks:function(blocks){var blocksJSON=this.blocksToJson(blocks);var tmpScope=this.owner.getScope(utils.createUUID(),null,false);var newBlocks=tmpScope.blocksFromJson(blocksJSON,false);newBlocks=tmpScope.allBlocks();for(var i=0;i<newBlocks.length;i++){var block=newBlocks[i];block.id=utils.createUUID();block.parentId=null}blocksJSON=this.blocksToJson(newBlocks);this.blocksFromJson(newBlocks);return newBlocks},blocksToJson:function(data){try{var result=[];data=data&&data.length?
data:this.blockStore?this.blockStore.data:this.blocks;for(var b in data){var block=data[b];if(block.keys==null)continue;var blockOut={_containsChildrenIds:[]};for(var prop in block){if(prop=="ctrArgs")continue;if(typeof block[prop]!=="function"&&!block.serializeField(prop))continue;if(this.isString(block[prop])||this.isNumber(block[prop])||this.isBoolean(block[prop]))blockOut[prop]=block[prop];if(prop!="parent")if(this.isBlock(block[prop])){blockOut[prop]=block[prop].id;blockOut._containsChildrenIds.push(prop)}else if(this.areBlocks(block[prop])){blockOut[prop]=
[];for(var i=0;i<block[prop].length;i++)blockOut[prop].push(block[prop][i].id);blockOut._containsChildrenIds.push(prop)}}result.push(blockOut)}}catch(e){console.error("from json failed : "+e)}return result},_createBlockStore:function(){},blocksFromJson:function(data,check){var resultSelected=[];for(var i=0;i<data.length;i++){var block=data[i];block["scope"]=this;if(block._containsChildrenIds==null)block._containsChildrenIds=[];var children=[];for(var cf=0;cf<block._containsChildrenIds.length;cf++){var propName=
block._containsChildrenIds[cf];children[propName]=block[propName];block[propName]=null}delete block._containsChildrenIds;if(!block.declaredClass){0&&console.log("   not a class ");continue}var blockClassProto=null;var _class=null;try{_class=utils.replaceAll(".","/",block.declaredClass);blockClassProto=require(_class)}catch(e){console.error("couldnt resolve class "+_class)}if(!blockClassProto){0&&console.log("couldnt resolve "+_class);continue}var blockOut=null;try{blockOut=factory.createBlock(blockClassProto,
block)}catch(e){console.error("error in block creation ",e);continue}blockOut._children=children;resultSelected.push(blockOut)}var allBlocks=this.allBlocks();for(var i=0;i<allBlocks.length;i++){var block=allBlocks[i];if(block._children){for(var propName in block._children)if(typeof block._children[propName]=="string"){var child=this.getBlockById(block._children[propName]);if(!child){0&&console.log("   couldnt resolve child: "+block._children[propName],block);continue}block[propName]=child;child.parent=
block}else if(typeof block._children[propName]=="object"){block[propName]=[];for(var j=0;j<block._children[propName].length;j++){var child=this.getBlockById(block._children[propName][j]);if(!child){0&&console.log("   couldnt resolve child: "+block._children[propName][j]);continue}block[propName].push(child)}}delete block._children}if(check!==false&&block.parentId!=null){var parent=this.getBlockById(block.parentId);if(parent==null){console.error("have orphan block!",block);debugger;block.remove()}}}var result=
this.allBlocks();return resultSelected},getBlockByName:function(name){for(var b in this.blocks)if(this.blocks[b].name===name)return this.blocks[b]},getBlockById:function(id){return this.blocks[id]},flatten:function(blocks){var result=[];for(var b in blocks){var block=blocks[b];if(block.keys==null)continue;result.push(block);for(var prop in block){if(prop=="ctrArgs")continue;if(prop!="parent")if(this.isBlock(block[prop]))result.push(block[prop]);else if(this.areBlocks(block[prop]))for(var i=0;i<block[prop].length;i++)result.push(block[prop][i])}}return result},
solveBlock:function(mixed,settings,force){settings=settings||{highlight:false};var block=null;if(this.isString(mixed))block=this.getBlockByName(mixed);else if(this.isObject(mixed))block=mixed;var result=null;if(block){if(settings.force!==true&&block.enabled==false){console.error("block is not enabled");return null}if(settings.force===true)settings.force=false;result=block.solve(this,settings)}else console.error("solving block failed, have no block! ",mixed);return result},solve:function(scope,settings){var ret=
"";for(var n=0;n<this.items.length;n++)ret+=this.items[n].solve(scope,settings);return ret},parseExpression:function(expression,addVariables){return this.expressionModel.parse(this,expression,addVariables)},isString:function(a){return typeof a=="string"},isNumber:function(a){return typeof a=="number"},isBoolean:function(a){return typeof a=="boolean"},isObject:function(a){return typeof a==="object"},isBlock:function(a){var ret=false;if(typeof a=="object"&&a!=null&&a.length==undefined)if(a.serializeMe)ret=
true;return ret},areBlocks:function(a){var ret=false;if(typeof a=="object"&&a!=null&&a.length>0)if(this.isBlock(a[0]))ret=true;return ret},_onVariableChanged:function(evt){if(evt.item&&this.expressionModel.variableFuncCache[evt.item.title])delete this.expressionModel.variableFuncCache[evt.item.title]},init:function(){this.subscribe(types.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged)},_destroy:function(){var allblocks=this.allBlocks();for(var i=0;i<allblocks.length;i++){var obj=allblocks[i];
if(obj._destroy)obj._destroy();if(obj.destroy)obj.destroy()}},moveTo:function(source,target,before,add){if(add)if(target.canAdd&&target.canAdd()){var sourceParent=this.getBlockById(source.parentId);if(sourceParent)sourceParent.removeBlock(source,false);target.add(source,null,null);return}else{console.error("cant reparent");return false}if(!target.parentId&&add==false){console.error("root level move");var sourceParent=this.getBlockById(source.parentId);if(sourceParent&&sourceParent.removeBlock){sourceParent.removeBlock(source,
false);source.parentId=null;source.group=target.group}var itemsToBeMoved=[];var groupItems=this.getBlocks({group:target.group});var rootLevelIndex=[];var store=this.getBlockStore();var sourceIndex=store.index[source.id];var targetIndex=store.index[target.id];for(var i=0;i<groupItems.length;i++){var item=groupItems[i];if(groupItems[i].parentId==null&&groupItems[i]!=source){var itemIndex=store.index[item.id];var add=before?itemIndex>=targetIndex:itemIndex<=targetIndex;if(add){itemsToBeMoved.push(groupItems[i]);
rootLevelIndex.push(store.index[groupItems[i].id])}}}for(var j=0;j<itemsToBeMoved.length;j++)store.remove(itemsToBeMoved[j].id);this.getBlockStore().remove(source.id);if(before)this.getBlockStore().put(source);for(var j=0;j<itemsToBeMoved.length;j++)store.put(itemsToBeMoved[j]);if(!before)this.getBlockStore().put(source);return true}else if(!source.parentId&&target.parentId&&add==false){source.group=target.group;if(target);}else if(!source.parentId&&!target.parentId&&add){console.error("we are adding an item into root root item");
if(target.canAdd&&target.canAdd()){source.group=null;target.add(source,null,null)}return true}else if(source.parentId&&target.parentId&&add==false&&source.parentId===target.parentId){console.error("we move within the same parents");var parent=this.getBlockById(source.parentId);if(!parent){console.error("     couldnt find parent ");return false}var maxSteps=20;var items=parent[parent._getContainer(source)];var cIndexSource=source.indexOf(items,source);var cIndexTarget=source.indexOf(items,target);
var direction=cIndexSource>cIndexTarget?-1:1;var distance=Math.abs(cIndexSource-(cIndexTarget+(before==true?-1:1)));for(var i=0;i<distance-1;i++)parent.move(source,direction);return true}else if(source.parentId&&target.parentId&&add==false&&source.parentId!==target.parentId){0&&console.log("same parent!");console.error("we move within the different parents");var sourceParent=this.getBlockById(source.parentId);if(!sourceParent){console.error("     couldnt find source parent ");return false}var targetParent=
this.getBlockById(target.parentId);if(!targetParent){console.error("     couldnt find target parent ");return false}if(sourceParent&&sourceParent.removeBlock&&targetParent.canAdd&&targetParent.canAdd()){sourceParent.removeBlock(source,false);targetParent.add(source,null,null)}else{console.error("cant reparent");return false}var items=targetParent[targetParent._getContainer(source)];if(items==null)console.error("weird : target parent has no item container");var cIndexSource=targetParent.indexOf(items,
source);var cIndexTarget=targetParent.indexOf(items,target);if(!cIndexSource||!cIndexTarget){console.error(" weird : invalid drop processing state, have no valid item indicies");return}var direction=cIndexSource>cIndexTarget?-1:1;var distance=Math.abs(cIndexSource-(cIndexTarget+(before==true?-1:1)));for(var i=0;i<distance-1;i++)targetParent.move(source,direction);return true}return false}})})},"xblox/manager/BlockManagerUI":function(){define(["dojo/_base/declare","dojo/has","xide/types","xide/utils",
"xide/factory","dojo/has!host-browser?xblox/views/BlockEditDialog","dojo/has!host-browser?xblox/views/BlockTreeView","dojo/dom-class","xide/manager/BeanManager","xide/views/CIViewMixin","xide/bean/Action"],function(declare,has,types,utils,factory,BlockEditDialog,BlockTreeView,domClass,BeanManager,CIViewMixin,Action){return declare("xblox/manager/BlockManagerUI",[BeanManager],{blockTreeView:null,targetTop:null,targetBottom:null,currentCIView:null,lastSelectedTopTabTitle:null,updatePalette:true,_contextChanged:false,
ignoreItemSelection:false,onReloaded:function(){0&&console.log("bm reload")},onSetWidgetPropertyActions:function(evt){},init:function(){},editBlock:function(item,changedCB){if(!item.canEdit())return;var title="Edit ",thiz=this;if(item.title)title+=item.title;else if(item.name)title+=item.name;try{var actionDialog=new BlockEditDialog({item:item,title:title,style:"width:400px",resizeable:true,delegate:{onOk:function(dlg,data){if(changedCB)changedCB(item);thiz.publish(types.EVENTS.ON_BLOCK_PROPERTY_CHANGED,
{item:item});thiz.onBlockSelected({item:item,owner:this.currentCIView})}}})}catch(e){}actionDialog.show();actionDialog.resize()},onCIUpdate:function(evt){if(evt["owner"]&&evt.owner.source&&evt.owner.source.delegate&&evt.owner.item&&evt.owner.delegate===this){if(!evt._processedBMUI)evt._processedBMUI=true;else return;var cis=evt.owner.getCIS();var item=evt.owner.item;var options=utils.toOptions(cis);for(var i=0;i<options.length;i++){var option=options[i];var field=option.dst;if(field!=null&&item[field]!=
null){if(option.active!=null&&option.active===false&&option.changed===false)continue;if(item[option.dst]!=option.value||item[option.dst]!==option.value){if(item.onChangeField)item.onChangeField(option.dst,option.value,cis,evt["owner"]);item[option.dst]=option.value}}}this.publish(types.EVENTS.ON_BLOCK_PROPERTY_CHANGED,{item:item});evt.owner.source.delegate.save()}},destroyWidgets:function(){},onActionContextChanged:function(evt){if(evt&&evt.beanType===types.ITEM_TYPE.BLOCK){this.blockTreeView=null;
this.targetTop=null;this.targetBottom=null;this.currentCIView=null;var main=this.ctx.getApplication().mainView;if(main)main._openRight()}else if(evt&&evt.beanType!==types.ITEM_TYPE.BLOCK){this.blockTreeView=null;this.targetTop=null;this.targetBottom=null;this.currentCIView=null}},shouldChangeActionContext:function(item){return!!(!item||!item.scope)},onReady:function(){var _EVENTS=types.EVENTS;this.subscribe([_EVENTS.ON_CI_UPDATE,_EVENTS.ON_ACTION_CONTEXT_CHANGED]);var thiz=this;this.subscribe("onItemSelected",
thiz.onBlockSelected)},onBlockSelected:function(evt){if(this.ignoreItemSelection)return;if(!evt.item||!evt.item.scope||evt.item.beanType!=="BLOCK")return;try{var block=evt.item;if(!block)return;if(!this.targetTop){this.targetTop=this.getRightTopTarget(true,true);domClass.add(this.targetTop.domNode,"CIDialog")}if(!this.targetTop){console.error("target top invalid");return}if(!this.targetTop){this.targetTop=this.getRightTopTarget(true,true);domClass.add(this.targetTop.domNode,"CIDialog")}if(!this.targetTop)return;
var mainView=this.ctx.getApplication().mainView;var layoutRight=mainView.layoutRight;if(layoutRight&&!domClass.contains(layoutRight.domNode,"xbloxPropertyView")){domClass.add(layoutRight.domNode,"xbloxPropertyView");mainView.layoutMain.resize()}if(this.targetTop.selectedChildWidget)this.lastSelectedTopTabTitle=this.targetTop.selectedChildWidget.title;if(this.currentCIView&&this.currentCIView.tabs){this.currentCIView.empty();try{for(var i=0;i<this.currentCIView.tabs.length;i++)this.targetTop.removeChild(this.currentCIView.tabs[i])}catch(e){console.error("clear failed")}}if(!block.getFields){0&&
console.log("have no fields",block);return}var cis=block.getFields();for(var i=0;i<cis.length;i++)cis[i].vertical=true;var ciView=new CIViewMixin({tabContainer:this.targetTop,delegate:this,viewStyle:"padding:0px;",autoSelectLast:true,item:block,source:evt.callee,options:{groupOrder:{"General":0,"Advanced":1,"Description":2}},cis:cis});ciView.initWithCIS(cis);this.currentCIView=ciView;if(block.onFieldsRendered)block.onFieldsRendered(block,cis);var containers=this.targetTop.getChildren();var descriptionView=
null;for(var i=0;i<containers.length;i++){containers[i].parentContainer=this.targetTop;if(containers[i].title==="Description")descriptionView=containers[i];if(this.targetTop.selectedChildWidget.title!==this.lastSelectedTopTabTitle)if(containers[i].title===this.lastSelectedTopTabTitle)this.targetTop.selectChild(containers[i])}if(!this.targetBottom)this.targetBottom=this.getRightBottomTarget(true,false);if(descriptionView&&this.targetBottom){this.targetBottom.destroyDescendants(false);this.currentCIView.tabs.remove(descriptionView);
descriptionView.parentContainer.removeChild(descriptionView);this.targetBottom.addChild(descriptionView);var main=this.getLayoutRightMain(false,false);main.resize()}if(this.blockTreeView);else{var main=this.ctx.getApplication().mainView;if(main)main._openRight();this.blockTreeView=this.createBlockTreeView(this.targetTop,"New")}}catch(e){console.error("publish ON_BLOCK_SELECTED failed "+e)}},createBlockTreeView:function(where,title,extraBlocks){try{var treeView=utils.addWidget(BlockTreeView,{title:title||
"Blocks",style:"padding:0px"},this,where,true);return treeView}catch(e){debugger}}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dojo/_base/declare","xblox/model/Block"],function(declare,Block){return declare("xblox.model.logic.ElseIfBlock",[Block],{condition:null,consequent:null,mayHaveChildren:function(){return this.consequent!=null},getChildren:function(parent){var result=[];if(this.consequent)result.push(this.consequent);return result},name:"else if",toText:function(){return this.name+
" "+this.condition},_checkCondition:function(scope){return scope.parseExpression(this.condition)}})})},"xblox/model/Expression":function(){define(["dojo/_base/declare","xblox/model/ModelBase","xide/types","xide/factory"],function(declare,ModelBase,types,factory){return declare("xblox.model.Expression",[ModelBase],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:{},parse:function(scope,expression,addVariables,runCallback,errorCallback,
context){expression=this.replaceAll("''","'",expression);expression=this.replaceVariables(scope,expression);if(!this.isScript(expression)&&(this.isString(expression)||this.isNumber(expression)))return expression;if(expression.indexOf("return")==-1)expression="return "+expression;else;addVariables=false;if(addVariables===true){var _otherVariables=scope.variablesToJavascript(null,expression);if(_otherVariables){expression=_otherVariables+expression;expression=this.replaceAll("''","'",expression)}}var parsed=
this;try{expression=this.replaceAll("''","'",expression);var _function=this.expressionCache[expression];if(!_function){_function=new Function("{"+expression+"; }");this.expressionCache[expression]=_function}parsed=_function.call(context||this.context||{})}catch(e){console.error("     invalid expression : \n"+expression,e);if(errorCallback)errorCallback("invalid expression : \n"+expression+": "+e);parsed=""+expression;return parsed}if(parsed===true)0&&console.log("        expression return true! : "+
expression);if(runCallback)runCallback("Expression "+expression+" evaluates to "+parsed);return parsed},parseVariableO:function(scope,_var){var value=""+_var.value;if(_var.title==="None")return"";try{var _otherVariables=scope.variablesToJavascript(_var,false);if(_otherVariables)value=_otherVariables+value;var _function=new Function("{"+value+"}");var _parsed=_function.call(this.context||{});if(_parsed==="undefined"||typeof _parsed==="undefined")value=""+_var.value;else if(!this.isNumber(_parsed)){value=
""+_parsed;value="'"+value+"'"}else value=_parsed}catch(e){console.error("parse variable failed : "+_var.title+"\n"+value)}return value},variableFuncCache:{},parseVariable:function(scope,_var){var value=""+_var.value;var _function=this.variableFuncCache[_var.title];if(!_function){_function=new Function("{"+value+"}");this.variableFuncCache[_var.title]=_function}var _parsed=_function.apply(this.context||{});if(_parsed==="undefined"||typeof _parsed==="undefined")value=""+_var.value;else if(!this.isNumber(_parsed)){value=
""+_parsed;value="'"+value+"'"}else value=_parsed;return value},replaceVariables:function(scope,expression,_evaluate,_escape){var ocurr=this._findOcurrences(expression,this.variableDelimiters);if(ocurr)for(var n=0;n<ocurr.length;n++){var _var=this._getVar(scope,ocurr[n]);var value=null;if(_var){value=this.getValue(_var.value);if(this.isScript(value)&&_evaluate!==false)try{var _otherVariables=scope.variablesToJavascript(_var,true);if(_otherVariables)value=_otherVariables+value;var _parsed=(new Function("{"+
value+"}")).call(this.context||{});0&&console.log(" parsed variable value to : "+_parsed);if(_parsed==="undefined"||typeof _parsed==="undefined")value=""+_var.value;else{value=_parsed;value="'"+value+"'"}}catch(e){0&&console.log(" parsed variable expression failed \n"+value,e)}else if(!this.isNumber(value))if(_escape!==false)value="'"+value+"'";else;else;}else{0&&console.log("   expression failed, no such variable :"+ocurr[n]+" ! setting to default "+"");value=""}expression=expression.replace(ocurr[n],
value)}return expression},replaceBlockCalls:function(scope,expression){var ocurr=this._findOcurrences(expression,this.blockCallDelimiters);if(ocurr)for(var n=0;n<ocurr.length;n++){var blockName=this._removeDelimiters(ocurr[n],this.blockCallDelimiters);var blockResult=scope.solveBlock(blockName).join("\n");expression=expression.replace(ocurr[n],blockResult)}return expression},_getVar:function(scope,vartext){return scope.getVariable(this._getVarName(vartext))},_getVarName:function(vartext){return this._removeDelimiters(vartext,
this.variableDelimiters)},_removeDelimiters:function(text,delimiters){var text=text.replace(delimiters.begin,"").replace(delimiters.end,"");return text},_escapeRegExp:function(string){var special=["[","]","(",")","{","}","*","+","."];for(var n=0;n<special.length;n++)string=string.replace(special[n],"\\"+special[n]);return string},_findOcurrences:function(expression,delimiters){var d={begin:this._escapeRegExp(delimiters.begin),end:this._escapeRegExp(delimiters.end)};var allExceptEnd="[^"+d.end+"]*";
var patt=d.begin+"("+allExceptEnd+")"+d.end;return expression.match(new RegExp(patt,"g"))}})})},"xblox/model/Targeted":function(){define(["dojo/_base/declare","./Referenced"],function(declare,Referenced){return declare("xblox.model.Targeted",[Referenced],{})})},"xblox/model/html/SetCSS":function(){define(["dojo/_base/declare","dojo/_base/lang","xblox/model/Block","xide/types","xide/mixins/EventedMixin","xblox/model/Targeted","dijit/registry"],function(declare,lang,Block,types,EventedMixin,Targeted,
registry){return declare("xblox.model.html.SetCSS",[Block,EventedMixin,Targeted],{name:"Set CSS",file:"",reference:"",references:null,description:"Sets HTML Node CSS",solve:function(scope,settings){this.onSuccess(this,settings)},toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.event)result+=this.event;return result},getFields:function(){try{var fields=this.inherited(arguments)||this.getDefaultFields();fields.push(this.utils.createCI("File",types.ECIType.FILE,this.file,
{group:"General",dst:"file",value:this.file,intermediateChanges:false,acceptFolders:false,acceptFiles:true,encodeFilePath:false,buildFullPath:true,filePickerOptions:{dialogTitle:"Select CSS File",filePickerMixin:{beanContextName:"CSSFilePicker",persistent:false,globalPanelMixin:{allowLayoutCookies:false}},configMixin:{beanContextName:"CSSFilePicker",LAYOUT_PRESET:types.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:false}},defaultStoreOptions:{"fields":1663,"includeList":"css","excludeList":"*"},
startPath:this.file}}));fields.push(this.utils.createCI("Target",types.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}))}catch(e){}return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},onReferenceChanged:function(newValue,cis){this._destroy();this.reference=newValue;var objects=this.resolveReference(this.deserialize(newValue))},onChangeField:function(field,newValue,cis){if(field=="file");if(field=="reference")this.onReferenceChanged(newValue,
cis);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){}})})},"xblox/views/BlockEditView":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/html","dojo/dom-class","dojo/on","dojo/_base/lang","dojo/dom-construct","xide/utils","xide/factory","xide/types","xide/views/CIView"],function(array,declare,html,domClass,on,lang,domConstruct,utils,factory,types,CIView){return declare("xblox.views.BlockEditView",[CIView],
{onSave:function(ci,value){if(this.delegate&&this.delegate.onSave)this.delegate.onSave(ci,value)},startup:function(){this.inherited(arguments)}})})},"xblox/views/BlocksFileEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","xide/views/BeanView","xide/views/BeanTreeView","xide/factory","xide/utils","dojo/store/Memory","dojo/store/Observable","xfile/views/_EditorMixin","xide/layout/ContentPane","xblox/views/GroupedBlockView","xblox/views/BlocksGridViewDefault","xblox/views/VariablesGridView",
"xblox/model/variables/Variable","dojo/Deferred"],function(declare,lang,BeanView,BeanTreeView,factory,utils,Memory,Observable,_EditorMixin,ContentPane,GroupedBlockView,BlocksGridViewDefault,VariablesGridView,Variable,Deferred){return declare("xblox.views.BlocksFileEditor",[BeanView,BeanTreeView,_EditorMixin],{_item:null,cssClass:"bloxEditor",blockManager:null,blockManagerClass:"xblox.manager.BlockManager",model:null,store:null,tree:null,currentItem:null,didLoad:false,selectable:false,beanType:"BLOCK",
blockScope:null,groupContainer:null,hasItemActions:function(){return true},getItemActions:function(){return this.inherited(arguments)},onReloaded:function(){this.destroyWidgets();this.openItem(this._item)},openItem:function(item){var dfd=new Deferred;this._item=item;var thiz=this;var blockManager=this.getBlockManager();blockManager.load(item.mount,item.path).then(function(scope){thiz.initWithScope(scope);dfd.resolve(thiz)});return dfd},initWithContent:function(content){var data=null;try{data=utils.getJson(content)}catch(e){console.error("invalid block data")}if(data)this.initWithData(data)},
initWithScope:function(blockScope){this.blockScope=blockScope;var allBlockGroups=blockScope.allGroups(),thiz=this;0&&console.log("       block groups",allBlockGroups);if(allBlockGroups.indexOf("Events")==-1)allBlockGroups.push("Events");if(allBlockGroups.indexOf("On Load")==-1)allBlockGroups.push("On Load");else;thiz.renderGroups(allBlockGroups,blockScope)},getScopeUserData:function(){return{owner:this}},initWithData:function(data){0&&console.log("init with data",data);var scopeId=utils.createUUID();
var blockInData=data;var variableInData=data;if(lang.isArray(data));else if(lang.isObject(data)){scopeId=data.scopeId||scopeId;blockInData=data.blocks||[];variableInData=data.variables||[]}var blockManager=this.getBlockManager();this.blockManager=blockManager;var scopeUserData=this.getScopeUserData();var blockScope=blockManager.getScope(scopeId,scopeUserData,true);var allBlocks=blockScope.blocksFromJson(blockInData);for(var i=0;i<allBlocks.length;i++){var obj=allBlocks[i];obj._lastRunSettings={force:false,
highlight:true}}var allVariables=blockScope.variablesFromJson(variableInData);blockManager.onBlocksReady(blockScope);0&&console.log("   got blocks",allBlocks);0&&console.log("   got variables",allVariables);if(allBlocks)return this.initWithScope(blockScope)},_createTreeStore:function(blockData){var data={items:blockData,identifier:"name",label:"name"};var blockStore=Observable(new Memory({data:data,getChildren:function(object){return object.items},mayHaveChildren:function(parent){return parent.items!=
null&&parent.items.length>0}}));return blockStore},destroyWidgets:function(){utils.destroyWidget(this.groupContainer);if(this.blockManager&&this.blockScope)this.blockManager.removeScope(this.blockScope.id);this.groupContainer=null;this.blockManager=null},destroy:function(){this.destroyWidgets();this.inherited(arguments)},getBlockManager:function(){if(!this.blockManager){if(this.ctx.blockManager)return this.ctx.blockManager;this.blockManager=factory.createInstance(this.blockManagerClass,{ctx:this.ctx});
0&&console.log("_createBlockManager ",this.blockManager)}return this.blockManager},createGroupContainer:function(){var tabContainer=utils.addWidget(dijit.layout.TabContainer,{tabStrip:true,tabPosition:"top",splitter:true,style:"min-width:450px;height:inherit;padding:0px;","className":"ui-widget-content"},null,this.containerNode,true);return tabContainer},getGroupContainer:function(){if(this.groupContainer)return this.groupContainer;this.groupContainer=this.createGroupContainer();return this.groupContainer},
createGroupView:function(groupContainer,group){return utils.addWidget(ContentPane,{delegate:this,title:group,closable:false,style:"padding:0px",cssClass:"blocksEditorPane",blockView:null,onShow:function(){if(this.blockView)this.blockView.onShow()}},this,groupContainer,true)},createGroupedBlockView:function(container,group,scope,extra){var thiz=this;var args={attachTo:container,beanContextName:this.beanContextName||scope.id,blockGroup:group,title:group,gridViewProto:BlocksGridViewDefault,blockScope:scope,
ctx:this.ctx,delegate:this,showAllBlocks:true,open:true,lazy:true,titlePane:false,canToggle:false,gridParams:{cssClass:"bloxGridView"}};if(extra)args=lang.mixin(args,extra);var view=new GroupedBlockView(args);view.startup();return view},renderGroups:function(_array,blockScope){var groupContainer=this.getGroupContainer();var lastChild=null,thiz=this;for(var i=0;i<_array.length;i++)try{var groupBlocks=blockScope.getBlocks({group:_array[i]});if(_array[i]!=="Variables"&&(!groupBlocks||!groupBlocks.length))continue;
var contentPane=this.createGroupView(groupContainer,_array[i],blockScope);var gridViewConstructurArgs={};if(_array[i]==="Variables"){gridViewConstructurArgs.newRootItemFunction=function(){try{var newItem=new Variable({title:"No-Title-Yet",type:13,value:"No Value",enumType:"VariableType",save:false,initialize:"",group:"Variables",id:utils.createUUID(),scope:blockScope})}catch(e){debugger}};gridViewConstructurArgs.onGridDataChanged=function(evt){0&&console.log("onGridDataChanged",evt);var item=evt.item;
if(item)item[evt.field]=evt.newValue;thiz.save()};gridViewConstructurArgs.showAllBlocks=false;gridViewConstructurArgs.newRootItemLabel="New Variable";gridViewConstructurArgs.newRootItemIcon="fa-code";gridViewConstructurArgs.storeField="variableStore";gridViewConstructurArgs.gridViewProto=VariablesGridView}gridViewConstructurArgs.newRootItemGroup=_array[i];lastChild=this.createGroupedBlockView(contentPane.containerNode,_array[i],blockScope,gridViewConstructurArgs);contentPane.blockView=lastChild;lastChild.parentContainer=
contentPane}catch(e){debugger}groupContainer.resize();if(lastChild);setTimeout(function(){if(thiz.parentContainer)thiz.parentContainer.resize()},500)},onSave:function(groupedBlockView){this.save()},save:function(){if(this.blockScope){var all={blocks:null,variables:null};var blocks=this.blockScope.blocksToJson();try{var _testData=dojo.fromJson(JSON.stringify(blocks))}catch(e){console.error("invalid data");return}var _onSaved=function(){};var variables=this.blockScope.variablesToJson();try{var _testData=
dojo.fromJson(JSON.stringify(variables))}catch(e){console.error("invalid data");return}all.blocks=blocks;all.variables=variables;this.saveContent(JSON.stringify(all,null,2),this._item,_onSaved)}},onGridKeyEnter:function(){this.editBlock(this.getItem())},onGridMouseDoubleClick:function(){this.editBlock(this.getItem())},startup:function(){if(this.didLoad)return;this.inherited(arguments);this.didLoad=true}})})},"xblox/model/events/OnEvent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array",
"dojo/Deferred","xblox/model/Block","xide/utils","xide/types","xide/mixins/EventedMixin","xblox/model/Referenced","dijit/registry","dojo/on"],function(declare,lang,array,Deferred,Block,utils,types,EventedMixin,Referenced,registry,on){return declare("xblox.model.events.OnEvent",[Block,EventedMixin,Referenced],{name:"On Event",event:"",reference:"",references:null,sharable:true,_nativeEvents:["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onkeypress","onkeydown",
"onkeyup","onfocus","onblur","onchange"],solve:function(scope,settings,run,error){if(!this._lastRunSettings&&settings)this._lastRunSettings=settings;settings=this._lastRunSettings||settings;this._currentIndex=0;this._return=[];var ret=[],items=this[this._getContainer()];if(items.length){var res=this.runFrom(items,0,settings);this.onSuccess(this,settings);return res}else this.onSuccess(this,settings);return ret},toText:function(){var result=this.getBlockIcon()+" "+this.name+" :: ";if(this.event)result+=
this.event;return result},canAdd:function(){return[]},getFields:function(){var fields=this.inherited(arguments)||this.getDefaultFields();var thiz=this;var _ref=this.deserialize(this.reference);var isNative=utils.contains(this._nativeEvents,this.event)>-1;var options=null;if(!isNative)options=this.scope.getEventsAsOptions(this.event);else{options=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},
{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}];for(var i=0;i<options.length;i++){var obj=options[i];if(obj.value===this.event){obj.selected=true;break}}}fields.push(this.utils.createCI("Event",types.ECIType.ENUMERATION,
this.event,{group:"General",options:options,dst:"event"}));fields.push(this.utils.createCI("Object/Widget",types.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return fields},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},mayHaveChildren:function(parent){return this.items!=null&&this.items.length>0},getChildren:function(parent){return this.items},onEvent:function(evt){this._lastResult=evt;this.solve(this.scope,this._lastRunSettings)},
_subscribe:function(evt,handler,obj){if(!evt)return;var isNative=utils.contains(this._nativeEvents,evt);if(isNative==-1)this.subscribe(evt,this.onEvent,obj);else if(obj){var _event=evt.replace("on",""),thiz=this;var handle=on(obj,_event,function(e){thiz.onEvent(e)});0&&console.log("wire native event : "+_event);this._events.push(handle)}},_registerEvent:function(evt){if(!evt||!evt.length)return;0&&console.log("register event : "+evt+" for "+this.reference);var objects=this.resolveReference(this.deserialize(this.reference));
var thiz=this;if(objects&&objects.length){for(var i=0;i<objects.length;i++){var obj=objects[i];if(obj&&obj.id){var _widget=registry.byId(obj.id);if(_widget&&_widget.on){var _event=this.event.replace("on","");0&&console.log("found widget : "+obj.id+" will register event "+_event);var _handle=_widget.on(_event,lang.hitch(this,function(e){0&&console.log("event triggered : "+thiz.event);thiz.onEvent(e)}));this._events.push(_handle)}else this._subscribe(evt,this.onEvent,obj)}else this._subscribe(evt,this.onEvent,
obj)}0&&console.log("objects found : ",objects)}else this._subscribe(evt,this.onEvent)},onLoad:function(){this._onLoaded=true;if(this.event&&this.event.length&&this.enabled)this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(objects,cis){var options=[];if(!objects||!objects.length)options=this.scope.getEventsAsOptions(this.event);else{options=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},
{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}];for(var i=0;i<options.length;i++){var obj=options[i];if(obj.value===this.event){obj.selected=true;break}}}for(var i=0;i<cis.length;i++){var ci=
cis[i];if(ci["widget"]&&ci["widget"].title==="Event"){var widget=ci["_widget"];widget.nativeWidget.set("options",options);widget.nativeWidget.reset();widget.nativeWidget.set("value",this.event);this.publish(types.EVENTS.RESIZE,{});break}}},onReferenceChanged:function(newValue,cis){this._destroy();this.reference=newValue;var objects=this.resolveReference(this.deserialize(newValue));this.updateEventSelector(objects,cis);this._registerEvent(this.event)},onChangeField:function(field,newValue,cis){if(field==
"event"){this._destroy();if(this._onLoaded){this.event=newValue;this._registerEvent(newValue)}}if(field=="reference")this.onReferenceChanged(newValue,cis);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(!this._events)this._events=[];array.forEach(this._events,dojo.unsubscribe);this._lastResult=null;this._events=[]}})})},"xblox/model/logic/IfBlock":function(){define(["dojo/_base/declare","xblox/model/Block",
"xblox/model/Statement"],function(declare,Block,Statement){return declare("xblox.model.logic.IfBlock",[Block],{condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:true,name:"if",add:function(proto,ctrArgs,where){var _args=arguments;if(where==null)where="consequent";var _block=this._add(proto,ctrArgs,where);return _block},addToStore:function(store){store.put(this)},mayHaveChildren:function(parent){return this.consequent!=null&&
this.consequent.length>0},getChildren:function(parent){var result=[];if(this.consequent)result=result.concat(this.consequent);return result},toText:function(){return this.getBlockIcon("E")+this.name+" "+this.toFriendlyName(this.condition)},solve:function(scope,settings){var solvedCondition=this._checkCondition(scope);if(solvedCondition){this.onSuccess(this,settings);var result=null;if(this.consequent&&this.consequent.length)for(var i=0;i<this.consequent.length;i++)result=this.consequent[i].solve(scope,
settings);return result}else{var anyElseIf=false;this.onFailed(this,settings);if(this.elseIfBlocks)for(var n=0;n<this.elseIfBlocks.length&&!anyElseIf;n++)if(this.elseIfBlocks[n].declaredClass=="xblox.model.logic.ElseIfBlock")if(this.elseIfBlocks[n]._checkCondition(scope)){anyElseIf=true;return this.elseIfBlocks[n].consequent.solve(scope,settings)}if(this.alternate&&this.alternate.length>0&&!anyElseIf){var result=null;for(var i=0;i<this.alternate.length;i++)result=this.alternate[i].solve(scope,settings);
return result}}return[]},empty:function(what){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.items)},removeBlock:function(what){if(what){if(what&&what.empty)what.empty();delete what.items;what.parent=null;this.alternate.remove(what);this.consequent.remove(what)}},_checkCondition:function(scope){return scope.parseExpression(this.condition+";",true)},_getContainer:function(item){if(this.consequent.contains(item))return"consequent";else if(this.alternate.contains(item))return"alternate";
return"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];for(var i=0;i<this.alternate.length;i++){this.alternate[i].parentId=this.id;this.alternate[i].parent=this}for(var i=0;i<this.consequent.length;i++){this.consequent[i].parentId=this.id;this.consequent[i].parent=this}var store=this.scope.blockStore},getFields:function(){var thiz=this;var fields=this.inherited(arguments);fields.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",
dst:"condition",delegate:{runExpression:function(val,run,error){return thiz.scope.expressionModel.parse(thiz.scope,val,false,run,error)}}}));return fields},postCreate:function(){var store=this.scope.blockStore;if(this.autoCreateElse||this.alternate.length>0){var _statement=new Statement({name:"else",items:this.alternate,group:this.group,owner:this,dstField:"alternate",parentId:this.parentId,parent:this.parent,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return false}});this.items.push(_statement);
for(var i=0;i<this.alternate.length;i++){this.alternate[i].parentId=_statement.id;this.alternate[i].parent=_statement}store.put(_statement);if(this.parent&&this.parent.declaredClass==="xblox.model.logic.IfBlock")this.parent.consequent.push(_statement);if(this.parent&&this.parent.items!=null)this.parent.items.push(_statement)}},_toPHP:function(params){},_toJavascript:function(params){},toCode:function(lang,params){switch(lang){case "Javascript":return this._toJavascript();case "PHP":return this._toPHP()}}})})},
"xblox/factory/Blocks":function(){define(["dojo/_base/lang","xide/factory","xide/utils","xide/types","xide/mixins/ReloadMixin","xide/mixins/EventedMixin","xblox/model/logic/CaseBlock","xblox/model/Block","xblox/model/functions/CallBlock","xblox/model/code/CallMethod","xblox/model/code/RunScript","xblox/model/loops/ForBlock","xblox/model/loops/WhileBlock","xblox/model/variables/VariableAssignmentBlock","xblox/model/logic/IfBlock","xblox/model/logic/ElseIfBlock","xblox/model/logic/SwitchBlock","xblox/model/variables/VariableSwitch",
"xblox/model/events/OnEvent","xblox/model/events/OnKey","xblox/model/logging/Log","xblox/model/html/SetStyle","xblox/model/html/SetCSS","xblox/model/server/RunServerMethod","xblox/model/code/RunBlock"],function(lang,factory,utils,types,ReloadMixin,EventedMixin,CaseBlock,Block,CallBlock,CallMethod,RunScript,ForBlock,WhileBlock,VariableAssignmentBlock,IfBlock,ElseIfBlock,SwitchBlock,VariableSwitch,OnEvent,OnKey,Log,SetStyle,SetCSS,RunServerMethod,RunBlock){var cachedAll=null;factory.clearVariables=
function(){};factory.getAllBlocks=function(scope,owner,target,group,allowCache){if(allowCache!==false&&cachedAll!=null){for(var i=0;i<cachedAll.length;i++){var obj=cachedAll[i];if(obj.name==="Set Variable"){cachedAll.remove(obj);break}}return cachedAll}else if(allowCache==false)cachedAll=null;var items=factory._getFlowBlocks(scope,owner,target,group);items=items.concat(factory._getLoopBlocks(scope,owner,target,group));items=items.concat(factory._getCommandBlocks(scope,owner,target,group));items=items.concat(factory._getCodeBlocks(scope,
owner,target,group));items=items.concat(factory._getEventBlocks(scope,owner,target,group));items=items.concat(factory._getLoggingBlocks(scope,owner,target,group));items=items.concat(factory._getHTMLBlocks(scope,owner,target,group));items=items.concat(factory._getServerBlocks(scope,owner,target,group));cachedAll=items;return items};factory._getCommandBlocks=function(scope,owner,target,group){var items=[];return items};factory._getServerBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Server",
iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:owner,iconClass:"fa-plug",proto:RunServerMethod,target:target,ctrArgs:{scope:scope,group:group}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:items,group:"Server"});return items};factory._getHTMLBlocks=function(scope,owner,target,group){var items=[];items.push({name:"HTML",iconClass:"fa-paint-brush",items:[{name:"Set Style",owner:owner,iconClass:"fa-paint-brush",proto:SetStyle,target:target,ctrArgs:{scope:scope,group:group}},
{name:"Set CSS",owner:owner,iconClass:"fa-paint-brush",proto:SetCSS,target:target,ctrArgs:{scope:scope,group:group}}]});return items};factory._getVariableBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:owner,iconClass:"el-icon-fork",proto:IfBlock,target:target,ctrArgs:{scope:scope,group:group,condition:"[value1]\x3d\x3d'PW'"}},{name:"Switch",owner:owner,iconClass:"el-icon-fork",proto:SwitchBlock,target:target,
ctrArgs:{scope:scope,group:group}}]});return items};factory._getEventBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:owner,iconClass:"fa-bell",proto:OnEvent,target:target,ctrArgs:{scope:scope,group:group}},{name:"On Key",owner:owner,iconClass:"fa-keyboard-o",proto:OnKey,target:target,ctrArgs:{scope:scope,group:group}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:items,group:"Events"});return items};
factory._getLoggingBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:owner,iconClass:"fa-bug",proto:Log,target:target,ctrArgs:{scope:scope,group:group}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:items,group:"Logging"});return items};factory._getCodeBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:owner,iconClass:"el-icon-video",
proto:CallMethod,target:target,ctrArgs:{scope:scope,group:group}},{name:"Run Script",owner:owner,iconClass:"fa-code",proto:RunScript,target:target,ctrArgs:{scope:scope,group:group}},{name:"Run Block",owner:owner,iconClass:"fa-code",proto:RunBlock,target:target,ctrArgs:{scope:scope,group:group}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:items,group:"Code"});return items};factory._getFlowBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Flow",iconClass:"el-icon-random",
items:[{name:"If...Else",owner:owner,iconClass:"el-icon-fork",proto:IfBlock,target:target,ctrArgs:{scope:scope,group:group,condition:"[value1]\x3d\x3d'PW'"}},{name:"Switch",owner:owner,iconClass:"el-icon-fork",proto:SwitchBlock,target:target,ctrArgs:{scope:scope,group:group}},{name:"Variable Switch",owner:owner,iconClass:"el-icon-fork",proto:VariableSwitch,target:target,ctrArgs:{scope:scope,group:group}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:items,group:"Flow"});return items};
factory._getLoopBlocks=function(scope,owner,target,group){var items=[];items.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:owner,iconClass:"el-icon-repeat",proto:WhileBlock,target:target,ctrArgs:{scope:scope,group:group,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:owner,iconClass:"el-icon-repeat",proto:ForBlock,target:target,ctrArgs:{scope:scope,group:group,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});factory.publish(types.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:items,group:"Loops"});return items};factory._getMathBlocks=function(scope,owner,dstItem,group){var items=[];items.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:dstItem,items:[{name:"If...Else",owner:dstItem,iconClass:"el-icon-compass",proto:IfBlock,item:dstItem,ctrArgs:{scope:scope,group:group}}]});return items};factory._getTimeBlocks=function(scope,owner,dstItem,group){var items=[];items.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:dstItem,items:[{name:"If...Else",
owner:dstItem,iconClass:"el-icon-time",proto:IfBlock,item:dstItem,ctrArgs:{scope:scope,group:group}}]});return items};factory._getTransformBlocks=function(scope,owner,dstItem,group){var items=[];items.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:dstItem,items:[{name:"If...Else",owner:dstItem,iconClass:"el-icon-time",proto:IfBlock,item:dstItem,ctrArgs:{scope:scope,group:group}}]});return items};factory.prepareBlockContructorArgs=function(ctorArgs){if(!ctorArgs)ctorArgs={};if(!ctorArgs["id"])ctorArgs["id"]=
utils.createUUID();if(!ctorArgs["items"])ctorArgs["items"]=[]};factory.createBlock=function(mixed,ctorArgs,baseClasses){factory.prepareBlockContructorArgs(ctorArgs);var block=factory.createInstance(mixed,ctorArgs,baseClasses);block.ctrArgs=null;try{if(block&&block.init)block.init();ReloadMixin.prototype.mergeFunctions(block,EventedMixin.prototype);ReloadMixin.prototype.mergeFunctions(block,ReloadMixin.prototype);if(block.scope)block.scope.registerBlock(block);try{if(block.initReload)block.initReload()}catch(e){debugger}}catch(e){debugger}if(!block)debugger;
return block};return factory})},"xblox/views/VariablesGridView":function(){define(["dojo/_base/declare","xide/views/BeanView","xide/types","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Editor","xide/views/GridView","dijit/form/TextBox","dijit/form/ValidationTextBox","xide/bean/Grouped"],function(declare,BeanView,types,OnDemandGrid,Selection,editor,GridView,TextBox,ValidationTextBox,Grouped){return declare("xblox.views.VariablesGridView",[BeanView,GridView,Grouped],{cssClass:"variablesGridView",onShow:function(){this.inherited(arguments);
this.publish(types.EVENTS.RESIZE);this.setCurrentGroup(this.delegate.blockGroup)},variableNameValidator:function(value,constraints){var thiz=this;var result=false;var reg=new RegExp(/^[0-9a-zA-Z ...\-_ ]+$/);if(value&&reg.test(value))if(thiz.delegate&&thiz.delegate.variableNameExists&&thiz.delegate.variableNameExists(value,this.object)){result=false;thiz.promptMessage="Item already exists";thiz.message="Item already exists"}else{result=true;thiz.message="Enter new variable name"}else{thiz.promptMessage=
"This is not a valid variable name, try without special characters!";thiz.message="This is not a valid variable name, try without special characters!";result=false}return result},createWidgets:function(store){var thiz=this;var grid=new (declare([OnDemandGrid,Selection]))({cellNavigation:false,store:store,deselectOnRefresh:false,columns:[editor({label:"Name",field:"title",sortable:true,canEdit:function(item){return item.readOnly===false},editorArgs:{required:true,promptMessage:"Enter a unique variable name",
validator:thiz.variableNameValidator,delegate:thiz.delegate,intermediateChanges:false}},ValidationTextBox),editor({label:"Value",field:"value",sortable:false,canEdit:function(item){return item.readOnly===false}},TextBox)]},this.containerNode);grid.refresh();this.grid=grid;this.onGridCreated(grid)},startup:function(){this.inherited(arguments);if(this.store)this.createWidgets(this.store)}})})},"xblox/model/loops/WhileBlock":function(){define(["dojo/_base/declare","xblox/model/Block","xblox/model/variables/Variable"],
function(declare,Block,Variable){return declare("xblox.model.loops.WhileBlock",Block,{condition:null,items:null,loopLimit:200,name:"While",wait:500,currentIndex:0,sharable:true,canAdd:function(){return[]},_solve:function(scope,settings){var ret=[];for(var n=0;n<this.items.length;n++)this.addToEnd(ret,this.items[n].solve(scope,settings));return ret},doStep:function(settings){if(this.currentIndex<this.loopLimit){var ret=[];var _cond=this._checkCondition(this.scope);if(_cond){this.onSuccess(this,settings);
var thiz=this;this.addToEnd(ret,this._solve(this.scope,settings));this.currentIndex++;setTimeout(function(){thiz.doStep(settings)},this.wait)}else this.onFailed(this,settings)}},solve:function(scope,settings){var iterations=0;var ret=[];if(this.wait>0){this.currentIndex=0;this.doStep(settings);return[]}while(this._checkCondition(scope)&&iterations<this.loopLimit){this.addToEnd(ret,this._solve(scope));iterations++}return ret},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},
_checkCondition:function(scope){return scope.parseExpression(this.condition)},mayHaveChildren:function(parent){return this.items!=null&&this.items.length>0},getChildren:function(parent){var result=[];if(this.items)result=result.concat(this.items);return result},getFields:function(){var thiz=this;var fields=this.inherited(arguments);fields.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(val,run,error){return thiz.scope.expressionModel.parse(thiz.scope,
val,false,run,error)}}}));fields.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return fields}})})},"xblox/views/BlocksGridViewDefault":function(){define(["dojo/_base/declare","dojo/_base/lang","xide/views/BeanView","xide/grid/_Base","xide/types","dgrid/OnDemandGrid","dgrid/Editor","dgrid/Tree","dgrid/extensions/DnD","xblox/widgets/DojoDndMixin","xblox/views/BlocksGridDndSource","xblox/views/BlocksGridView","xblox/widgets/BlockGridRowEditor","xide/bean/Grouped"],
function(declare,lang,BeanView,_Base,types,OnDemandGrid,Editor,Tree,Dnd,DojoDndMixin,BlocksGridDndSource,BlocksGridView,BlockGridRowEditor,Grouped){return declare("xblox.views.BlocksGridViewDefault",[BeanView,BlocksGridView,Grouped],{cssClass:"basicCommandsGridView",beanType:"BLOCK",hasItemActions:function(){return true},getItem:function(){return this.activeItem},getItemActions:function(){return this.inherited(arguments)},onPreview:function(){if(this.delegate.onPreview)this.delegate.onPreview(this.activeItem)},
onReloaded:function(){if(this.delegate)this.delegate.onReloaded()},onShow:function(){this.setCurrentGroup(this.delegate.blockGroup);this.inherited(arguments);this.publish(types.EVENTS.RESIZE)},onGridDataChanged:function(evt){0&&console.log("on grid data changed ",evt)},createWidgets:function(store){var SharedDndGridSource=declare([BlocksGridDndSource,DojoDndMixin],{blockScope:this.blockScope,delegate:this.delegate,onDndDrop:function(source,nodes,copy,target){if(this.targetAnchor)this._removeItemClass(this.targetAnchor,
"Hover");if(this==target)this.onDrop(source,nodes,copy,target);this.onDndCancel()}});var baseClasses=[OnDemandGrid,_Base,Editor,Tree,Dnd];baseClasses=this.getGridBaseClasses(baseClasses,{keyboardNavigation:true,keyboardSelect:false,selection:true});var _ctorArgs={cellNavigation:false,sort:null,collection:store,dndConstructor:SharedDndGridSource,shouldHandleKey:function(key){return!(key==39||key==37)},columns:[{renderExpando:true,label:"Name",field:"name",sortable:false,editor:BlockGridRowEditor}],
dndParams:{allowNested:true,checkAcceptance:function(source,nodes){return true},isSource:true}};if(this.gridParams)_ctorArgs=lang.mixin(_ctorArgs,this.gridParams);_ctorArgs.deselectOnRefresh=false;try{var grid=new (declare(baseClasses))(_ctorArgs,this.containerNode);grid.refresh();this.grid=grid;this.onGridCreated(grid)}catch(e){debugger}},startup:function(){this.inherited(arguments);if(this.store)this.createWidgets(this.store)}})})},"xblox/manager/ClipboardManager":function(){define(["dojo/_base/declare",
"xide/types","xide/manager/ClipboardManager"],function(declare,types,ClipboardManager){return declare([ClipboardManager],{currentCopySelection:null,currentCutSelection:null,onPaste:function(data){if(data.didPaste)return;data.didPaste=true;var selection=this.currentCopySelection||this.currentCutSelection;var isCopy=this.currentCopySelection!=null;if(selection&&data.type===types.ITEM_TYPE.BLOCK&&data.callee&&data.callee.paste)data.callee.paste(selection,data.callee,isCopy)},onCopy:function(data){var selection=
data.items;if(selection&&data.type===types.ITEM_TYPE.BLOCK)this.currentCopySelection=selection;this.currentCutSelection=null},onCut:function(data){var selection=data?data?data.items?data.items:null:null:null;if(selection&&data.type===types.ITEM_TYPE.BLOCK)this.currentCutSelection=selection;this.currentCopySelection=null}})})}}});
//# sourceMappingURL=xblox.js.map